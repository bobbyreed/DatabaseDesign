<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 12: MongoDB - CSCI 5603</title>

    <!-- Database Design Presentation Styles -->
    <link rel="stylesheet" href="../../styles/presentation.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">

    <!-- Import Courier Prime for analog feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">

    <!-- Lecture-Specific Styles -->
    <style>
        /* Override font for analog feel */
        body, .slide, h1, h2, h3, p, li {
            font-family: 'Courier Prime', 'IBM Plex Mono', 'Courier New', monospace !important;
        }

        /* MongoDB-specific code styling */
        .code-example {
            background: #2b2b2b;
            color: #f8f8f2;
            padding: 15px;
            border-radius: 8px;
            font-family: 'IBM Plex Mono', monospace;
            margin: 10px 0;
            white-space: pre;
            overflow-x: auto;
        }

        .comparison-table {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin: 20px 0;
        }

        .comparison-card {
            background: var(--bg-accent);
            padding: 20px;
            border-radius: 10px;
            border-top: 4px solid var(--border-color);
        }

        .table-comparison {
            width: 100%;
            border-collapse: collapse;
            margin: 20px 0;
            font-size: 0.9em;
        }

        .table-comparison th {
            background: var(--ocu-true-blue);
            color: white;
            padding: 12px;
            text-align: left;
        }

        .table-comparison td {
            border: 1px solid var(--border-color);
            padding: 10px;
        }

        .emoji {
            font-size: 1.2em;
        }

        /* Deployment and hands-on activity styles */
        .deployment-step {
            background: var(--bg-secondary);
            border-left: 4px solid var(--ocu-true-blue);
            padding: 15px 20px;
            margin: 15px 0;
            border-radius: 5px;
        }

        .deployment-step h4 {
            color: var(--ocu-true-blue);
            margin-top: 0;
        }

        .command-box {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 15px;
            border-radius: 5px;
            font-family: 'IBM Plex Mono', monospace;
            margin: 10px 0;
            overflow-x: auto;
        }

        .checkpoint {
            background: var(--success-color, #4caf50);
            color: white;
            padding: 10px 15px;
            border-radius: 5px;
            margin: 10px 0;
            font-weight: bold;
        }

        .activity-box {
            background: var(--ocu-light-blue, #e3f2fd);
            color: var(--ocu-true-blue, #1976d2);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            border: 2px solid var(--ocu-true-blue, #1976d2);
        }

        .timer-badge {
            background: var(--ocu-cyan, #00bcd4);
            color: white;
            padding: 5px 15px;
            border-radius: 20px;
            font-size: 0.9em;
        }

        .success-box {
            background: #e8f5e9;
            color: #2e7d32;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #4caf50;
        }

        .warning-box {
            background: #fff3e0;
            color: #e65100;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #ff9800;
        }

        .info-box, .demo-box {
            background: var(--bg-secondary);
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border: 1px solid var(--border-color);
        }

        .tip-box {
            background: #e3f2fd;
            color: #1976d2;
            padding: 15px;
            border-radius: 8px;
            margin: 15px 0;
            border-left: 4px solid #2196f3;
        }
    </style>
</head>
<body>
    <div class="presentation-container">
        <!-- Theme Toggle -->
        <button class="theme-toggle" aria-label="Toggle theme">üåô</button>

        <!-- Timer display -->
        <div class="timer-display" id="timer-display">
            <span id="timer-text">Lecture 12: MongoDB
                 <button class="home"><a href="../../index.html">Home</a></button>
            </span>
        </div>

        <!-- Slide 1: Title -->
        <div class="slide active">
            <h1>MongoDB</h1>
            <h2>NoSQL Document Database & MERN Stack <span class="emoji">üçÉ</span></h2>
            <p style="font-size: 1.5em; margin-top: 40px;">CSCI 5603 - Database Design</p>
            <p style="font-size: 1.3em;">Week 7, Lecture 12</p>
            <p style="margin-top: 60px; font-size: 1.2em;">Instructor: Bobby Reed</p>
            <p style="margin-top: auto; font-style: italic;">Exploring the world of NoSQL!</p>
        </div>

        <!-- Slide 2: Today's Agenda -->
        <div class="slide">
            <h1>Today's Agenda</h1>
            <ul style="font-size: 1.3em; line-height: 2;">
                <li>NoSQL vs SQL Databases</li>
                <li>MongoDB Fundamentals & BSON</li>
                <li>MongoDB CRUD Operations</li>
                <li>Aggregation Framework & $lookup</li>
                <li class="highlight">Hands-On: Deploy Express Backend to Render</li>
                <li class="highlight">Hands-On: Deploy React Frontend to Netlify</li>
                <li class="highlight">Test Full-Stack MERN Application!</li>
            </ul>
            <div class="tip-box" style="margin-top: 20px;">
                <strong>Prerequisites:</strong> You should have completed MongoDB Atlas setup from last lecture (connection string ready!)
            </div>
        </div>

        <!-- Slide 3: Historical Context -->
        <div class="slide">
            <h1>Historical Context <span class="emoji">üìú</span></h1>
            <h2>The Birth of MongoDB and Document Databases</h2>

            <div class="concept-box">
                <h3>10gen to MongoDB (2007-2009)</h3>
                <p style="font-size: 1.15em; line-height: 1.7;">MongoDB's origin story began at a company called 10gen, where it was initially developed as a component for an internal platform-as-a-service (PaaS) product. When the PaaS didn't gain traction, the team recognized that their database component was solving real problems that developers faced. They made the bold decision to pivot entirely, focusing solely on the database and releasing the first version of MongoDB in 2009‚Äîa move that would reshape the NoSQL landscape.</p>
            </div>

            <div class="concept-box">
                <h3>Document Model Design</h3>
                <p style="font-size: 1.15em; line-height: 1.7;">The JSON-like Document Model (MongoDB's BSON format) was an intentional move away from the rigid structure of the relational model. This design choice catered to the needs of modern, rapidly changing internet applications where schemas evolve constantly, data is hierarchical and nested, and developers work primarily in object-oriented languages. MongoDB's document model allowed developers to store data in the same format they used in their application code‚Äîreducing the "impedance mismatch" between database and application.</p>
            </div>

            <div class="tip-box">
                <strong>Key Insight:</strong> MongoDB's success demonstrates that sometimes the right database model isn't about replacing relational databases‚Äîit's about matching the data model to how modern applications actually work. The document model's flexibility made it ideal for agile development, where requirements change frequently and data structures need to adapt quickly.
            </div>
        </div>

        <!-- Slide 4: NoSQL Introduction -->
        <div class="slide">
            <h1>NoSQL Databases</h1>
            <h2>Why NoSQL?</h2>
            <div class="demo-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li><strong>Scalability:</strong> Horizontal scaling across servers</li>
                    <li><strong>Flexibility:</strong> Schema-less design</li>
                    <li><strong>Performance:</strong> Optimized for specific data models</li>
                    <li><strong>Big Data:</strong> Handle large volumes of unstructured data</li>
                </ul>
            </div>
            <div class="tip-box">
                <strong>Note:</strong> NoSQL = "Not Only SQL" - Complements rather than replaces SQL
            </div>
        </div>

        <!-- Slide 4: SQL vs NoSQL Comparison -->
        <div class="slide">
            <h1>SQL vs NoSQL</h1>
            <table class="table-comparison">
                <thead>
                    <tr>
                        <th>Aspect</th>
                        <th>SQL (Relational)</th>
                        <th>NoSQL (MongoDB)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td>Data Model</td>
                        <td>Tables with rows</td>
                        <td>Collections with documents</td>
                    </tr>
                    <tr>
                        <td>Schema</td>
                        <td>Fixed schema</td>
                        <td>Flexible schema</td>
                    </tr>
                    <tr>
                        <td>Relationships</td>
                        <td>Foreign keys & JOINs</td>
                        <td>Embedded documents & references</td>
                    </tr>
                    <tr>
                        <td>Query Language</td>
                        <td>SQL</td>
                        <td>MongoDB Query Language</td>
                    </tr>
                    <tr>
                        <td>Scaling</td>
                        <td>Vertical (mostly)</td>
                        <td>Horizontal (sharding)</td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Slide 5: MongoDB Introduction -->
        <div class="slide">
            <h1>What is MongoDB?</h1>
            <div class="demo-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>Document-oriented NoSQL database</li>
                    <li>Stores data in <strong>BSON</strong> format (Binary JSON)</li>
                    <li>Schema-flexible collections</li>
                    <li>Rich query capabilities</li>
                    <li>Built-in replication and sharding</li>
                </ul>
            </div>
            <div style="text-align: center; margin-top: 30px;">
                <p style="font-size: 3em;">üçÉ</p>
                <p style="font-size: 1.2em;">MongoDB - The leading NoSQL database</p>
            </div>
        </div>

        <!-- Slide 6: MongoDB Structure -->
        <div class="slide">
            <h1>MongoDB Structure</h1>
            <div class="code-example">
MongoDB Server
  ‚îî‚îÄ‚îÄ Database (e.g., "myapp")
      ‚îî‚îÄ‚îÄ Collection (e.g., "users")
          ‚îî‚îÄ‚îÄ Document (BSON/JSON object)
              ‚îî‚îÄ‚îÄ Fields (key-value pairs)
            </div>
            <div class="info-box">
                <p><strong>Database:</strong> Container for collections</p>
                <p><strong>Collection:</strong> Group of documents (like a table)</p>
                <p><strong>Document:</strong> Individual record (like a row)</p>
            </div>
        </div>

        <!-- Slide 7: JSON Document Example -->
        <div class="slide">
            <h1>Document Structure</h1>
            <div class="code-example">
{
  "_id": ObjectId("5f8a7b2b9d3b2c1a3c8b4567"),
  "name": "John Doe",
  "email": "john@example.com",
  "age": 28,
  "address": {
    "street": "123 Main St",
    "city": "Oklahoma City",
    "state": "OK",
    "zip": "73102"
  },
  "hobbies": ["reading", "coding", "hiking"],
  "createdAt": ISODate("2023-10-15T09:00:00Z")
}
            </div>
            <div class="tip-box">
                <strong>Key Feature:</strong> Documents can contain nested objects and arrays
            </div>
        </div>

        <!-- Slide 8: BSON Types -->
        <div class="slide">
            <h1>BSON Data Types</h1>
            <div class="demo-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li><code>String</code>: UTF-8 text</li>
                    <li><code>Number</code>: Integer (32/64-bit) or Double</li>
                    <li><code>Boolean</code>: true/false</li>
                    <li><code>ObjectId</code>: Unique identifier (12 bytes)</li>
                    <li><code>Date</code>: ISODate format</li>
                    <li><code>Array</code>: Ordered list of values</li>
                    <li><code>Object</code>: Embedded document</li>
                    <li><code>null</code>: Null value</li>
                </ul>
            </div>
        </div>

        <!-- Slide 9: MongoDB Connection -->
        <div class="slide">
            <h1>Connecting with Node.js</h1>
            <div class="code-example">
const { MongoClient } = require('mongodb');

// Connection URI
const uri = "mongodb://localhost:27017";
// For MongoDB Atlas:
// const uri = "mongodb+srv://username:password@cluster.mongodb.net";

const client = new MongoClient(uri);

async function connect() {
    try {
        await client.connect();
        console.log("Connected to MongoDB!");

        const database = client.db('myapp');
        const collection = database.collection('users');

        // Your operations here

    } finally {
        await client.close();
    }
}

connect().catch(console.error);
            </div>
        </div>

        <!-- Slide 10: CRUD Operations Title -->
        <div class="slide">
            <h1 style="text-align: center; font-size: 3em; margin-top: 100px;">CRUD Operations</h1>
            <h2 style="text-align: center; font-size: 2em; color: var(--ocu-true-blue);">Create, Read, Update, Delete</h2>
        </div>

        <!-- Slide 11: Create - insertOne -->
        <div class="slide">
            <h1>Create - Insert Documents</h1>
            <h3>insertOne()</h3>
            <div class="code-example">
const result = await collection.insertOne({
    name: "Alice Smith",
    email: "alice@example.com",
    age: 25,
    role: "developer"
});

console.log(`Inserted document with _id: ${result.insertedId}`);
            </div>
            <div class="success-box">
                <strong>Result:</strong> MongoDB automatically generates an <code>_id</code> field if not provided
            </div>
        </div>

        <!-- Slide 12: Create - insertMany -->
        <div class="slide">
            <h1>Create - Insert Many</h1>
            <h3>insertMany()</h3>
            <div class="code-example">
const documents = [
    { name: "Bob", email: "bob@example.com", age: 30 },
    { name: "Carol", email: "carol@example.com", age: 28 },
    { name: "Dave", email: "dave@example.com", age: 35 }
];

const result = await collection.insertMany(documents);
console.log(`${result.insertedCount} documents were inserted`);
            </div>
            <div class="tip-box">
                <strong>Tip:</strong> insertMany() is more efficient than multiple insertOne() calls
            </div>
        </div>

        <!-- Slide 13: Read Operations -->
        <div class="slide">
            <h1>Read - Find Documents</h1>
            <h3>findOne() and find()</h3>
            <div class="code-example">
// Find one document
const user = await collection.findOne({ name: "Alice Smith" });

// Find all documents matching criteria
const cursor = collection.find({ age: { $gte: 25 } });
const users = await cursor.toArray();

// Find with projection (select specific fields)
const projection = { _id: 0, name: 1, email: 1 };
const result = await collection.find({}, { projection }).toArray();
            </div>
        </div>

        <!-- Slide 14: Query Operators -->
        <div class="slide">
            <h1>Query Operators</h1>
            <div class="code-example">
// Comparison operators
{ age: { $gt: 25 } }        // greater than
{ age: { $gte: 25 } }       // greater than or equal
{ age: { $lt: 30 } }        // less than
{ age: { $ne: 25 } }        // not equal
{ name: { $in: ["Alice", "Bob"] } }  // in array

// Logical operators
{ $and: [{ age: { $gt: 25 } }, { role: "developer" }] }
{ $or: [{ age: { $lt: 25 } }, { role: "manager" }] }

// Regex pattern matching
{ email: { $regex: /.*@example\.com$/ } }

// Array queries
{ hobbies: "coding" }                    // array contains
{ hobbies: { $all: ["coding", "reading"] } }  // contains all
            </div>
        </div>

        <!-- Slide 15: Update Operations -->
        <div class="slide">
            <h1>Update - Modify Documents</h1>
            <h3>updateOne() and updateMany()</h3>
            <div class="code-example">
// Update one document
const result = await collection.updateOne(
    { name: "Alice Smith" },                    // filter
    { $set: { age: 26, role: "senior developer" } }  // update
);

// Update many documents
await collection.updateMany(
    { age: { $lt: 30 } },
    { $inc: { age: 1 } }  // increment age by 1
);

// Update operators
{ $set: { field: value } }      // set field value
{ $unset: { field: "" } }        // remove field
{ $inc: { count: 1 } }           // increment
{ $push: { array: value } }      // add to array
{ $pull: { array: value } }      // remove from array
            </div>
        </div>

        <!-- Slide 16: Delete Operations -->
        <div class="slide">
            <h1>Delete - Remove Documents</h1>
            <h3>deleteOne() and deleteMany()</h3>
            <div class="code-example">
// Delete one document
const result = await collection.deleteOne({ name: "Dave" });
console.log(`${result.deletedCount} document deleted`);

// Delete many documents
const deleteResult = await collection.deleteMany({
    age: { $lt: 25 }
});
console.log(`${deleteResult.deletedCount} documents deleted`);

// Delete all documents in collection (use with caution!)
await collection.deleteMany({});
            </div>
            <div class="warning-box">
                <strong>Warning:</strong> deleteMany({}) with an empty filter deletes ALL documents!
            </div>
        </div>

        <!-- Slide 17: Aggregation Framework Title -->
        <div class="slide">
            <h1 style="text-align: center; font-size: 3em; margin-top: 100px;">Aggregation Framework</h1>
            <h2 style="text-align: center; font-size: 2em; color: var(--ocu-true-blue);">Data Processing Pipeline</h2>
        </div>

        <!-- Slide 18: Aggregation Pipeline -->
        <div class="slide">
            <h1>Aggregation Pipeline</h1>
            <div class="code-example">
const pipeline = [
    // Stage 1: Filter documents
    { $match: { age: { $gte: 25 } } },

    // Stage 2: Group and calculate
    { $group: {
        _id: "$role",
        avgAge: { $avg: "$age" },
        count: { $sum: 1 }
    }},

    // Stage 3: Sort results
    { $sort: { avgAge: -1 } },

    // Stage 4: Limit results
    { $limit: 5 }
];

const results = await collection.aggregate(pipeline).toArray();
            </div>
        </div>

        <!-- Slide 19: $lookup - MongoDB JOINs -->
        <div class="slide">
            <h1>$lookup - MongoDB JOINs</h1>
            <p>Similar to SQL JOINs, connects data from multiple collections</p>
            <div class="code-example">
// Orders collection with user references
const pipeline = [
    {
        $lookup: {
            from: "users",           // collection to join
            localField: "userId",    // field from orders
            foreignField: "_id",     // field from users
            as: "userDetails"        // output array field
        }
    },
    {
        $unwind: "$userDetails"      // deconstruct array
    }
];

const ordersWithUsers = await ordersCollection
    .aggregate(pipeline)
    .toArray();
            </div>
        </div>

        <!-- Slide 20: Complex Aggregation Example -->
        <div class="slide">
            <h1>Complex Aggregation Example</h1>
            <div class="code-example">
// E-commerce analytics pipeline
const salesPipeline = [
    // Match orders from last month
    { $match: {
        orderDate: {
            $gte: new Date("2024-01-01"),
            $lt: new Date("2024-02-01")
        }
    }},

    // Lookup product details
    { $lookup: {
        from: "products",
        localField: "productId",
        foreignField: "_id",
        as: "product"
    }},

    // Group by product category
    { $group: {
        _id: "$product.category",
        totalRevenue: { $sum: "$amount" },
        orderCount: { $sum: 1 },
        avgOrderValue: { $avg: "$amount" }
    }},

    // Sort by revenue
    { $sort: { totalRevenue: -1 } }
];
            </div>
        </div>

        <!-- Transition to MERN Stack -->
        <div class="slide">
            <h1 style="text-align: center; font-size: 3em; margin-top: 100px;">Building the MERN Stack</h1>
            <h2 style="text-align: center; font-size: 2em; color: var(--ocu-true-blue);">From MongoDB to Full-Stack Application</h2>

            <div class="demo-box" style="margin-top: 50px; font-size: 1.2em;">
                <p><strong>You've learned:</strong></p>
                <ul>
                    <li>‚úÖ MongoDB fundamentals and CRUD operations</li>
                    <li>‚úÖ Aggregation and $lookup for complex queries</li>
                    <li>‚úÖ Set up MongoDB Atlas with connection string</li>
                </ul>
            </div>

            <div class="success-box" style="margin-top: 20px; font-size: 1.2em;">
                <p><strong>Now let's build:</strong> A complete full-stack application!</p>
                <p style="margin-top: 10px;">Express Backend ‚Üí React Frontend ‚Üí All deployed to the cloud!</p>
            </div>
        </div>

        <!-- Hands-On Activity: Backend & Frontend Deployment -->

        <!-- Backend Deployment Overview -->
        <div class="slide">
            <h1>Hands-On: Backend Deployment <span class="emoji">üöÄ</span></h1>
            <h2><span class="timer-badge">30 minutes</span></h2>

            <div class="activity-box">
                <h3>What We'll Do:</h3>
                <ol style="font-size: 1.2em; line-height: 1.8;">
                    <li>Fork the starter Express.js repository</li>
                    <li>Review the backend code (MongoDB queries)</li>
                    <li>Deploy to Render</li>
                    <li>Configure environment variables with your Atlas connection</li>
                    <li>Test API endpoints</li>
                </ol>
            </div>

            <div class="demo-box">
                <h3>Repository to Fork:</h3>
                <div class="command-box">
https://github.com/yourusername/taskmanager-backend
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;"><em>Note: Your instructor will provide the actual repository URL</em></p>
            </div>

            <button data-timer="30">Start 30-Minute Timer</button>
        </div>

        <!-- Backend Code Structure -->
        <div class="slide">
            <h1>Understanding the Backend Code</h1>

            <div class="demo-box">
                <h3>Project Structure:</h3>
                <div class="code-example">
taskmanager-backend/
‚îú‚îÄ‚îÄ server.js          # Main server file
‚îú‚îÄ‚îÄ routes/
‚îÇ   ‚îî‚îÄ‚îÄ tasks.js       # Task routes (API endpoints)
‚îú‚îÄ‚îÄ models/
‚îÇ   ‚îî‚îÄ‚îÄ Task.js        # MongoDB schema
‚îú‚îÄ‚îÄ package.json       # Dependencies
‚îî‚îÄ‚îÄ .env.example       # Environment variables template
                </div>
            </div>

            <div class="demo-box">
                <h3>Key Dependencies:</h3>
                <ul style="font-size: 1.05em;">
                    <li><strong>express</strong> - Web framework</li>
                    <li><strong>mongoose</strong> - MongoDB ODM (Object Data Modeling)</li>
                    <li><strong>cors</strong> - Enable cross-origin requests</li>
                    <li><strong>dotenv</strong> - Environment variables management</li>
                </ul>
            </div>
        </div>

        <!-- MongoDB Connection Code -->
        <div class="slide">
            <h1>MongoDB Connection (server.js)</h1>

            <div class="code-example" style="background: #1e1e1e; color: #d4d4d4;">
<span style="color: #6a9955;">// Import required packages</span>
<span style="color: #569cd6;">const</span> express = require(<span style="color: #ce9178;">'express'</span>);
<span style="color: #569cd6;">const</span> mongoose = require(<span style="color: #ce9178;">'mongoose'</span>);
<span style="color: #569cd6;">const</span> cors = require(<span style="color: #ce9178;">'cors'</span>);
require(<span style="color: #ce9178;">'dotenv'</span>).config();

<span style="color: #6a9955;">// Initialize Express app</span>
<span style="color: #569cd6;">const</span> app = express();

<span style="color: #6a9955;">// Middleware</span>
app.use(cors());
app.use(express.json());

<span style="color: #6a9955;">// Connect to MongoDB Atlas with YOUR connection string</span>
mongoose.connect(process.env.MONGODB_URI)
  .then(() => console.log(<span style="color: #ce9178;">'MongoDB connected successfully'</span>))
  .catch(err => console.error(<span style="color: #ce9178;">'MongoDB connection error:'</span>, err));

<span style="color: #6a9955;">// Import routes</span>
<span style="color: #569cd6;">const</span> taskRoutes = require(<span style="color: #ce9178;">'./routes/tasks'</span>);
app.use(<span style="color: #ce9178;">'/api/tasks'</span>, taskRoutes);

<span style="color: #6a9955;">// Start server</span>
<span style="color: #569cd6;">const</span> PORT = process.env.PORT || 5000;
app.listen(PORT, () => console.log(<span style="color: #ce9178;">`Server running on port ${PORT}`</span>));
            </div>

            <div class="tip-box">
                <strong>Key Point:</strong> The connection string comes from <code>process.env.MONGODB_URI</code> - this will be your Atlas connection from last lecture!
            </div>
        </div>

        <!-- MongoDB Schema Code -->
        <div class="slide">
            <h1>Task Schema (models/Task.js)</h1>

            <div class="code-example" style="background: #1e1e1e; color: #d4d4d4;">
<span style="color: #569cd6;">const</span> mongoose = require(<span style="color: #ce9178;">'mongoose'</span>);

<span style="color: #6a9955;">// Define Task schema</span>
<span style="color: #569cd6;">const</span> taskSchema = <span style="color: #569cd6;">new</span> mongoose.Schema({
  title: {
    type: String,
    required: [<span style="color: #569cd6;">true</span>, <span style="color: #ce9178;">'Title is required'</span>],
    trim: <span style="color: #569cd6;">true</span>,
    maxlength: [100, <span style="color: #ce9178;">'Title cannot exceed 100 characters'</span>]
  },
  description: {
    type: String,
    trim: <span style="color: #569cd6;">true</span>
  },
  completed: {
    type: Boolean,
    <span style="color: #569cd6;">default</span>: <span style="color: #569cd6;">false</span>
  }
}, {
  timestamps: <span style="color: #569cd6;">true</span> <span style="color: #6a9955;">// Adds createdAt and updatedAt automatically</span>
});

module.exports = mongoose.model(<span style="color: #ce9178;">'Task'</span>, taskSchema);
            </div>

            <div class="success-box">
                <strong>Mongoose Magic:</strong> This schema validates data before saving to MongoDB and provides helpful methods for CRUD operations!
            </div>
        </div>

        <!-- API Routes Code Part 1 -->
        <div class="slide">
            <h1>CRUD Routes (routes/tasks.js) - Part 1</h1>

            <div class="code-example" style="background: #1e1e1e; color: #d4d4d4; font-size: 0.9em;">
<span style="color: #569cd6;">const</span> express = require(<span style="color: #ce9178;">'express'</span>);
<span style="color: #569cd6;">const</span> router = express.Router();
<span style="color: #569cd6;">const</span> Task = require(<span style="color: #ce9178;">'../models/Task'</span>);

<span style="color: #6a9955;">// GET all tasks - Uses MongoDB find()</span>
router.get(<span style="color: #ce9178;">'/'</span>, <span style="color: #569cd6;">async</span> (req, res) => {
  <span style="color: #569cd6;">try</span> {
    <span style="color: #569cd6;">const</span> tasks = <span style="color: #569cd6;">await</span> Task.find().sort({ createdAt: -1 });
    res.json(tasks);
  } <span style="color: #569cd6;">catch</span> (error) {
    res.status(500).json({ message: error.message });
  }
});

<span style="color: #6a9955;">// POST create new task - Uses MongoDB insertOne()</span>
router.post(<span style="color: #ce9178;">'/'</span>, <span style="color: #569cd6;">async</span> (req, res) => {
  <span style="color: #569cd6;">const</span> task = <span style="color: #569cd6;">new</span> Task({
    title: req.body.title,
    description: req.body.description
  });
  <span style="color: #569cd6;">try</span> {
    <span style="color: #569cd6;">const</span> newTask = <span style="color: #569cd6;">await</span> task.save();
    res.status(201).json(newTask);
  } <span style="color: #569cd6;">catch</span> (error) {
    res.status(400).json({ message: error.message });
  }
});
            </div>
        </div>

        <!-- API Routes Code Part 2 -->
        <div class="slide">
            <h1>CRUD Routes (routes/tasks.js) - Part 2</h1>

            <div class="code-example" style="background: #1e1e1e; color: #d4d4d4; font-size: 0.85em;">
<span style="color: #6a9955;">// PUT update task - Uses MongoDB updateOne()</span>
router.put(<span style="color: #ce9178;">'/:id'</span>, <span style="color: #569cd6;">async</span> (req, res) => {
  <span style="color: #569cd6;">try</span> {
    <span style="color: #569cd6;">const</span> task = <span style="color: #569cd6;">await</span> Task.findByIdAndUpdate(
      req.params.id,
      req.body,
      { <span style="color: #569cd6;">new</span>: <span style="color: #569cd6;">true</span>, runValidators: <span style="color: #569cd6;">true</span> }
    );
    <span style="color: #569cd6;">if</span> (!task) <span style="color: #569cd6;">return</span> res.status(404).json({ message: <span style="color: #ce9178;">'Task not found'</span> });
    res.json(task);
  } <span style="color: #569cd6;">catch</span> (error) {
    res.status(400).json({ message: error.message });
  }
});

<span style="color: #6a9955;">// DELETE task - Uses MongoDB deleteOne()</span>
router.delete(<span style="color: #ce9178;">'/:id'</span>, <span style="color: #569cd6;">async</span> (req, res) => {
  <span style="color: #569cd6;">try</span> {
    <span style="color: #569cd6;">const</span> task = <span style="color: #569cd6;">await</span> Task.findByIdAndDelete(req.params.id);
    <span style="color: #569cd6;">if</span> (!task) <span style="color: #569cd6;">return</span> res.status(404).json({ message: <span style="color: #ce9178;">'Task not found'</span> });
    res.json({ message: <span style="color: #ce9178;">'Task deleted successfully'</span> });
  } <span style="color: #569cd6;">catch</span> (error) {
    res.status(500).json({ message: error.message });
  }
});

module.exports = router;
            </div>

            <div class="tip-box">
                <strong>Database Operations:</strong> Notice <code>find()</code>, <code>save()</code>, <code>findByIdAndUpdate()</code>, and <code>findByIdAndDelete()</code> - these are Mongoose methods that interact with MongoDB!
            </div>
        </div>

        <!-- Deploy to Render -->
        <div class="slide">
            <h1>Step 1: Deploy Backend to Render</h1>

            <div class="deployment-step">
                <h4>1.1 Fork and Clone Repository</h4>
                <ul style="font-size: 1.05em;">
                    <li>Fork the backend repository on GitHub</li>
                    <li>Your fork: <code>https://github.com/YOUR-USERNAME/taskmanager-backend</code></li>
                </ul>
            </div>

            <div class="deployment-step">
                <h4>1.2 Create Render Account & New Web Service</h4>
                <ul style="font-size: 1.05em;">
                    <li>Go to <strong>https://render.com</strong> and sign up</li>
                    <li>Click <strong>"New +"</strong> ‚Üí <strong>"Web Service"</strong></li>
                    <li>Connect your GitHub account</li>
                    <li>Select your forked <strong>taskmanager-backend</strong> repository</li>
                </ul>
            </div>

            <div class="deployment-step">
                <h4>1.3 Configure Web Service</h4>
                <ul style="font-size: 1.05em;">
                    <li><strong>Name:</strong> taskmanager-api (or your choice)</li>
                    <li><strong>Environment:</strong> Node</li>
                    <li><strong>Build Command:</strong> <code>npm install</code></li>
                    <li><strong>Start Command:</strong> <code>node server.js</code></li>
                    <li><strong>Plan:</strong> Free</li>
                </ul>
            </div>
        </div>

        <!-- Configure Environment Variables -->
        <div class="slide">
            <h1>Step 2: Set Environment Variables</h1>

            <div class="deployment-step">
                <h4>2.1 Add MongoDB Connection String</h4>
                <p>Before clicking "Create Web Service", scroll to <strong>Environment Variables</strong>:</p>
                <ul style="font-size: 1.05em;">
                    <li>Click <strong>"Add Environment Variable"</strong></li>
                    <li><strong>Key:</strong> <code>MONGODB_URI</code></li>
                    <li><strong>Value:</strong> Paste your MongoDB connection string from last lecture!</li>
                </ul>
                <div class="command-box" style="font-size: 0.85em; margin-top: 10px;">
mongodb+srv://dbUser:yourpassword@cluster0.xxxxx.mongodb.net/taskmanager?retryWrites=true&w=majority
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;"><strong>Important:</strong> Add <code>/taskmanager</code> after <code>.net</code> to specify the database name!</p>
            </div>

            <div class="deployment-step">
                <h4>2.2 Create and Deploy</h4>
                <ul style="font-size: 1.05em;">
                    <li>Click <strong>"Create Web Service"</strong></li>
                    <li>Wait 5-10 minutes for initial deployment</li>
                    <li>Watch the logs - look for "MongoDB connected successfully"</li>
                </ul>
            </div>

            <div class="checkpoint">
                ‚úì CHECKPOINT: Your API is live! Copy the URL: https://your-api.onrender.com
            </div>
        </div>

        <!-- Test Backend -->
        <div class="slide">
            <h1>Step 3: Test Your API</h1>

            <div class="deployment-step">
                <h4>3.1 Test with Browser</h4>
                <p>Visit your Render URL + <code>/api/tasks</code>:</p>
                <div class="command-box">
https://your-api.onrender.com/api/tasks
                </div>
                <p style="margin-top: 10px;">You should see JSON array with your sample task from Atlas!</p>
            </div>

            <div class="deployment-step">
                <h4>3.2 Test with Postman or Thunder Client</h4>
                <p><strong>Create a Task (POST Request):</strong></p>
                <ul style="font-size: 1.0em;">
                    <li>URL: <code>https://your-api.onrender.com/api/tasks</code></li>
                    <li>Method: POST</li>
                    <li>Headers: <code>Content-Type: application/json</code></li>
                    <li>Body (JSON):</li>
                </ul>
                <div class="code-example" style="margin-top: 10px;">
{
  "title": "Test from Postman",
  "description": "Verifying API works!"
}
                </div>
            </div>

            <div class="success-box">
                <strong>Success!</strong> If you get a 201 status with the new task, your backend is fully operational!
            </div>
        </div>

        <!-- Frontend Deployment Overview -->
        <div class="slide">
            <h1>Hands-On: Frontend Deployment <span class="emoji">‚öõÔ∏è</span></h1>
            <h2><span class="timer-badge">20 minutes</span></h2>

            <div class="activity-box">
                <h3>What We'll Do:</h3>
                <ol style="font-size: 1.2em; line-height: 1.8;">
                    <li>Fork the React frontend repository</li>
                    <li>Update API URL to point to your Render backend</li>
                    <li>Deploy to Netlify</li>
                    <li>Test the full-stack application</li>
                </ol>
            </div>

            <div class="demo-box">
                <h3>Repository to Fork:</h3>
                <div class="command-box">
https://github.com/yourusername/taskmanager-frontend
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;"><em>Note: Your instructor will provide the actual repository URL</em></p>
            </div>

            <button data-timer="20">Start 20-Minute Timer</button>
        </div>

        <!-- Frontend Code Structure -->
        <div class="slide">
            <h1>Understanding the Frontend Code</h1>

            <div class="demo-box">
                <h3>Project Structure:</h3>
                <div class="code-example">
taskmanager-frontend/
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ App.js         # Main component
‚îÇ   ‚îú‚îÄ‚îÄ components/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskList.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ TaskForm.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ TaskItem.js
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tasks.js   # API calls (YOU'LL UPDATE THIS!)
‚îÇ   ‚îî‚îÄ‚îÄ index.js
‚îú‚îÄ‚îÄ package.json
‚îî‚îÄ‚îÄ public/
                </div>
            </div>

            <div class="demo-box">
                <h3>Key Dependencies:</h3>
                <ul style="font-size: 1.05em;">
                    <li><strong>react</strong> - UI library</li>
                    <li><strong>axios</strong> - HTTP client for API calls</li>
                </ul>
            </div>
        </div>

        <!-- API Configuration -->
        <div class="slide">
            <h1>Frontend API Configuration (src/api/tasks.js)</h1>

            <div class="code-example" style="background: #1e1e1e; color: #d4d4d4;">
<span style="color: #569cd6;">import</span> axios <span style="color: #569cd6;">from</span> <span style="color: #ce9178;">'axios'</span>;

<span style="color: #6a9955;">// IMPORTANT: Change this to your Render API URL!</span>
<span style="color: #569cd6;">const</span> API_URL = <span style="color: #ce9178;">'https://your-api.onrender.com/api/tasks'</span>;

<span style="color: #6a9955;">// Get all tasks</span>
<span style="color: #569cd6;">export const</span> getTasks = () => axios.get(API_URL);

<span style="color: #6a9955;">// Create task</span>
<span style="color: #569cd6;">export const</span> createTask = (task) => axios.post(API_URL, task);

<span style="color: #6a9955;">// Update task</span>
<span style="color: #569cd6;">export const</span> updateTask = (id, task) =>
  axios.put(<span style="color: #ce9178;">`${API_URL}/${id}`</span>, task);

<span style="color: #6a9955;">// Delete task</span>
<span style="color: #569cd6;">export const</span> deleteTask = (id) =>
  axios.delete(<span style="color: #ce9178;">`${API_URL}/${id}`</span>);
            </div>

            <div class="warning-box">
                <strong>ACTION REQUIRED:</strong> You MUST update <code>API_URL</code> to your actual Render backend URL before deploying!
            </div>
        </div>

        <!-- Deploy to Netlify -->
        <div class="slide">
            <h1>Step 4: Update API URL & Deploy to Netlify</h1>

            <div class="deployment-step">
                <h4>4.1 Fork Repository</h4>
                <ul style="font-size: 1.05em;">
                    <li>Fork the frontend repository on GitHub</li>
                    <li>Your fork: <code>https://github.com/YOUR-USERNAME/taskmanager-frontend</code></li>
                </ul>
            </div>

            <div class="deployment-step">
                <h4>4.2 Update API URL</h4>
                <ul style="font-size: 1.05em;">
                    <li>Edit <code>src/api/tasks.js</code> in your forked repo (use GitHub web editor)</li>
                    <li>Replace <code>API_URL</code> with your Render backend URL</li>
                    <li>Commit the change: "Update API URL to Render backend"</li>
                </ul>
            </div>

            <div class="deployment-step">
                <h4>4.3 Deploy to Netlify</h4>
                <ul style="font-size: 1.05em;">
                    <li>Go to <strong>https://netlify.com</strong> and sign up</li>
                    <li>Click <strong>"Add new site"</strong> ‚Üí <strong>"Import an existing project"</strong></li>
                    <li>Connect to GitHub and select <strong>taskmanager-frontend</strong></li>
                    <li><strong>Build command:</strong> <code>npm run build</code></li>
                    <li><strong>Publish directory:</strong> <code>build</code></li>
                    <li>Click <strong>"Deploy site"</strong></li>
                </ul>
            </div>
        </div>

        <!-- Test Full Stack -->
        <div class="slide">
            <h1>Step 5: Test Your Full-Stack App! <span class="emoji">üéâ</span></h1>

            <div class="deployment-step">
                <h4>5.1 Open Your Deployed App</h4>
                <ul style="font-size: 1.05em;">
                    <li>Netlify will provide a URL like: <code>https://random-name.netlify.app</code></li>
                    <li>Open this URL in your browser</li>
                </ul>
            </div>

            <div class="deployment-step">
                <h4>5.2 Test All CRUD Operations</h4>
                <ul style="font-size: 1.1em; line-height: 1.7;">
                    <li>‚úÖ <strong>CREATE:</strong> Add a new task using the form</li>
                    <li>‚úÖ <strong>READ:</strong> See all tasks load from MongoDB</li>
                    <li>‚úÖ <strong>UPDATE:</strong> Toggle task completion status</li>
                    <li>‚úÖ <strong>DELETE:</strong> Remove a task</li>
                </ul>
            </div>

            <div class="success-box">
                <h3>Congratulations! Your full-stack MERN application is live!</h3>
                <p style="font-size: 1.1em; margin-top: 10px;">React (Netlify) ‚Üí Express (Render) ‚Üí MongoDB (Atlas)</p>
            </div>

            <div class="checkpoint">
                ‚úì CHECKPOINT: All three services are connected and working together!
            </div>
        </div>

        <!-- Exercises and Homework Continue Below -->

        <!-- In-Class Exercise 1 -->
        <div class="slide">
            <h1>Exercise 1: MongoDB CRUD Practice</h1>
            <div class="activity-box">
                <h3>Your Task:</h3>
                <p>Write MongoDB commands for the following:</p>
                <ol>
                    <li><strong>Complex Find:</strong> Find all users who are over 25 years old,
                        live in "Oklahoma City", and have "coding" in their hobbies array.</li>
                    <li><strong>Insert Many:</strong> Insert 3 new product documents with
                        nested price object containing amount and currency.</li>
                    <li><strong>Update with $set:</strong> Update a user's address.city field
                        and add a new field "lastModified" with current timestamp.</li>
                </ol>
            </div>
            <button data-timer="900">Start 15-Minute Timer</button>
        </div>

        <!-- Slide 27: Exercise 1 Solution -->
        <div class="slide">
            <h1>Exercise 1 - Solution</h1>
            <div class="code-example">
// 1. Complex Find
db.users.find({
    age: { $gt: 25 },
    "address.city": "Oklahoma City",
    hobbies: "coding"
});

// 2. Insert Many
db.products.insertMany([
    {
        name: "Laptop",
        price: { amount: 999.99, currency: "USD" },
        category: "Electronics"
    },
    {
        name: "Mouse",
        price: { amount: 29.99, currency: "USD" },
        category: "Accessories"
    },
    {
        name: "Keyboard",
        price: { amount: 79.99, currency: "USD" },
        category: "Accessories"
    }
]);

// 3. Update with $set
db.users.updateOne(
    { email: "john@example.com" },
    {
        $set: {
            "address.city": "Norman",
            lastModified: new Date()
        }
    }
);
            </div>
        </div>

        <!-- Slide 28: In-Class Exercise 2 -->
        <div class="slide">
            <h1>Exercise 2: MERN Deployment Kickoff</h1>
            <div class="activity-box">
                <h3>Your Task:</h3>
                <p>Deploy a minimal MERN application:</p>
                <ol>
                    <li>Clone the starter repo: <code>mern-starter-2024</code></li>
                    <li>Deploy React frontend to Netlify via GitHub</li>
                    <li>Deploy Express backend to Render via GitHub</li>
                    <li>Update the React API endpoint to your Render URL</li>
                    <li>Test the connection</li>
                </ol>
                <p style="margin-top: 20px;"><strong>Note:</strong> We'll walk through this together!</p>
            </div>
        </div>

        <!-- Slide 29: Homework Assignments -->
        <div class="slide">
            <h1>Homework Assignments</h1>
            <div class="info-box">
                <h3>Part 1: MongoDB $lookup Query</h3>
                <p>Write a MongoDB aggregation pipeline that:</p>
                <ul>
                    <li>Connects orders and products collections</li>
                    <li>Calculates total revenue per product category</li>
                    <li>Filters for orders from the last 30 days</li>
                    <li>Sorts by highest revenue</li>
                </ul>
            </div>
            <div class="info-box">
                <h3>Part 2: MERN Deployment Extension</h3>
                <ul>
                    <li>Add a new GET route <code>/api/stats</code> to Express</li>
                    <li>Implement MongoDB aggregation in the route</li>
                    <li>Deploy via GitHub (auto CI/CD)</li>
                    <li>Document your Render deployment URL</li>
                </ul>
            </div>
        </div>

        <!-- Slide 30: Best Practices -->
        <div class="slide">
            <h1>MongoDB Best Practices</h1>
            <div class="demo-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li><strong>Schema Design:</strong> Embed for 1:1 and 1:few, reference for 1:many</li>
                    <li><strong>Indexing:</strong> Create indexes on frequently queried fields</li>
                    <li><strong>Connection Pooling:</strong> Reuse database connections</li>
                    <li><strong>Error Handling:</strong> Always use try-catch with async/await</li>
                    <li><strong>Security:</strong> Use connection strings with authentication</li>
                    <li><strong>Validation:</strong> Implement schema validation rules</li>
                </ul>
            </div>
        </div>

        <!-- Slide 31: Common Pitfalls -->
        <div class="slide">
            <h1>Common MongoDB Pitfalls</h1>
            <div class="warning-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>‚ùå Not closing database connections</li>
                    <li>‚ùå Forgetting to handle Promise rejections</li>
                    <li>‚ùå Using synchronous operations</li>
                    <li>‚ùå Storing large binary data in documents</li>
                    <li>‚ùå Not using projection to limit returned fields</li>
                    <li>‚ùå Creating too many indexes</li>
                    <li>‚ùå Ignoring the 16MB document size limit</li>
                </ul>
            </div>
        </div>

        <!-- Slide 32: Resources -->
        <div class="slide">
            <h1>Resources</h1>
            <div class="demo-box">
                <h3>Documentation & Learning:</h3>
                <ul>
                    <li>MongoDB Documentation: <a href="https://docs.mongodb.com/">docs.mongodb.com</a></li>
                    <li>Node.js Driver: <a href="https://mongodb.github.io/node-mongodb-native/">MongoDB Driver Docs</a></li>
                    <li>MongoDB University: Free courses at <a href="https://university.mongodb.com/">university.mongodb.com</a></li>
                </ul>
                <h3>Tools:</h3>
                <ul>
                    <li>MongoDB Atlas: Free tier cloud hosting</li>
                    <li>MongoDB Compass: GUI for database management</li>
                    <li>Mongoose ODM: Object modeling for Node.js</li>
                </ul>
            </div>
        </div>

        <!-- Slide 33: Summary -->
        <div class="slide">
            <h1>Summary</h1>
            <div class="success-box">
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>‚úÖ MongoDB is a flexible NoSQL document database</li>
                    <li>‚úÖ Documents are stored as BSON (Binary JSON)</li>
                    <li>‚úÖ CRUD operations: insertOne/Many, find, updateOne/Many, deleteOne/Many</li>
                    <li>‚úÖ Aggregation framework for complex data processing</li>
                    <li>‚úÖ $lookup performs JOIN-like operations</li>
                    <li>‚úÖ MERN stack: Popular full-stack JavaScript solution</li>
                    <li>‚úÖ Modern deployment: Netlify (React) + Render (Express) + Atlas (MongoDB)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 34: Questions -->
        <div class="slide">
            <h1 style="text-align: center;">Questions?</h1>
            <div style="text-align: center; font-size: 5em; margin-top: 80px;">
                ü§î‚ùì
            </div>
            <p style="text-align: center; font-size: 1.3em; margin-top: 60px;">
                Ready for the exercises?
            </p>
            <div class="tip-box">
                <strong>Remember:</strong> MongoDB queries return Promises - use async/await!
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="navigation">
            <button id="prevBtn">Previous</button>
            <span class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">44</span>
            </span>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <!-- Shared Presentation JavaScript -->
    <script src="../../js/presentation.js"></script>

    <!-- Lecture-Specific JavaScript -->
    <script>
        // MongoDB specific interactions
        document.addEventListener('slidechange', (e) => {
            console.log(`Slide ${e.detail.currentSlide + 1} of ${e.detail.totalSlides}`);
        });
    </script>
</body>
</html>
