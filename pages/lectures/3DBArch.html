<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Lecture 03 - Database Architecture - CSCI 5603</title>
    
    <!-- Database Design Presentation Styles with Theme Support -->
    <link rel="stylesheet" href="../../styles/presentation.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    
    <!-- Import Courier Prime for analog feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lecture-Specific Styles -->
    <style>
        /* Override font for analog feel */
        body, .slide, h1, h2, h3, p, li {
            font-family: 'Courier Prime', 'IBM Plex Mono', 'Courier New', monospace !important;
        }
        
        /* Database-specific styling */
        .erd-diagram {
            background: var(--bg-accent);
            border: 2px solid var(--border-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            font-family: 'Courier Prime', monospace;
        }

        /* SQL syntax highlighting classes now in presentation.css */

        .table-schema {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            font-family: 'IBM Plex Mono', monospace;
        }
        
        .table-schema th {
            background: var(--ocu-true-blue);
            color: white;
            padding: 12px;
            text-align: left;
            font-weight: 600;
        }
        
        .table-schema td {
            border: 1px solid var(--border-color);
            padding: 10px;
            background: var(--bg-secondary);
        }
        
        .table-schema tr:nth-child(even) td {
            background: var(--bg-accent);
        }

        /* JSON and XML syntax highlighting classes now in presentation.css */
    </style>
</head>
<body>
    <!-- Theme toggle will be automatically added by JavaScript -->
    
    <div class="presentation-container">
        <!-- Timer display -->
        <div class="timer-display" id="timer-display">
            <span id="timer-text">Lecture 03 - Database Architecture
                 <button class="home"><a href="../../index.html">Home</a></button>
            </span>
        </div>

        <!-- Slide 1: Title -->
        <div class="slide active">
            <h1>Database Architecture</h1>
            <h2>Understanding DBMS Structure <span class="emoji">🏗️</span></h2>
            <p style="font-size: 1.5em; margin-top: 40px;">CSCI 5603 - Database Design</p>
            <p style="font-size: 1.3em;">Week 2, Lecture 3</p>
            <p style="margin-top: auto; font-style: italic;">Building robust database foundations for tomorrow's applications!</p>
        </div>

        <!-- Slide 2: Learning Objectives -->
        <div class="slide">
            <h1>Today's Learning Objectives</h1>
            <ul style="font-size: 1.4em; line-height: 2;">
                <li>🎯 Master the ANSI-SPARC three-level database architecture</li>
                <li>🎯 Understand DBMS controlled access features (security, integrity, concurrency, recovery)</li>
                <li>🎯 Analyze three-tier application architecture components</li>
                <li>🎯 Compare centralized vs. distributed database architectures</li>
                <li>🎯 Explore modern cloud and microservices database patterns</li>
                <li>🎯 Apply architectural principles to system design scenarios</li>
            </ul>
        </div>

        <!-- Slide 3: Historical Context -->
        <div class="slide">
            <h1>Historical Context <span class="emoji">📜</span></h1>
            <h2>Before the Relational Era</h2>

            <div class="concept-box">
                <h3>Pre-Relational Models (1960s)</h3>
                <p style="font-size: 1.15em; line-height: 1.7;">Before the relational model, the <strong>Hierarchical Model</strong> (exemplified by IBM's IMS) and the <strong>Network Model</strong> (CODASYL) were the dominant database architectures. These systems enforced both fixed schemas and rigid access paths, making structural changes extremely difficult and limiting flexibility.</p>
            </div>

            <div class="concept-box">
                <h3>The Three-Schema Architecture (1970s)</h3>
                <p style="font-size: 1.15em; line-height: 1.7;">The concept of the three-schema architecture (External, Conceptual, Internal) was developed in the 1970s as a foundational framework to achieve <strong>data independence</strong>—a key architectural goal for modern DBMS. This separation of concerns allowed changes at one level without impacting others.</p>
            </div>

            <div class="tip-box">
                <strong>Key Insight:</strong> The evolution from hierarchical/network models to the three-schema architecture laid the groundwork for the flexibility we expect from modern databases.
            </div>
        </div>

        <!-- Slide 4: Quick Recap from Last Week -->
        <div class="slide">
            <h1>Quick Recap: Last Week's Foundations <span class="emoji">📚</span></h1>

            <div class="demo-box">
                <h3>What We Learned in Lecture 2:</h3>
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li><strong>File-Based Systems:</strong> Separate programs managing their own data (CSV, XML, JSON)</li>
                    <li><strong>Five Key Limitations:</strong> Data separation, duplication, dependence, incompatible formats, fixed queries</li>
                    <li><strong>The Database Solution:</strong> Shared collection of logically related data + DBMS</li>
                    <li><strong>Database Languages:</strong> DDL (define structure) and DML (manipulate data)</li>
                    <li><strong>Database Roles:</strong> DA, DBA, Designers, Programmers, End Users</li>
                </ul>
            </div>

            <div class="success-box">
                <h3>Key Takeaway:</h3>
                <p style="font-size: 1.2em;">Databases emerged to solve file-based system problems through centralization, data independence, and controlled access.</p>
            </div>
        </div>

        <!-- Slide 5: Today's Focus -->
        <div class="slide">
            <h1>Today's Focus: Database Architecture <span class="emoji">🏗️</span></h1>

            <div class="demo-box">
                <h3>From "Why Databases?" to "How Databases Work"</h3>
                <p style="font-size: 1.2em;">Last week we learned <strong>why</strong> databases are better than file systems. Today we'll explore <strong>how</strong> databases are actually structured and organized.</p>
            </div>

            <div class="erd-diagram" style="padding: 30px;">
                <pre style="text-align: center; font-size: 1.0em;">
    Today's Architectural Journey:

    ┌─────────────────────────────────┐
    │   ANSI-SPARC Three-Level Arch   │ ← How DBMS separates concerns
    └─────────────────────────────────┘
                  ↓
    ┌─────────────────────────────────┐
    │   Three-Tier Application Arch   │ ← How apps connect to databases
    └─────────────────────────────────┘
                  ↓
    ┌─────────────────────────────────┐
    │  Centralized vs. Distributed    │ ← How databases scale globally
    └─────────────────────────────────┘
                </pre>
            </div>

            <div class="tip-box">
                <strong>Learning Goal:</strong> Understand the architectural decisions that make modern database systems powerful, scalable, and secure.
            </div>
        </div>

        <!-- Slide 6: Controlled Access Features -->
        <div class="slide">
            <h1>Database Controlled Access</h1>
            <p>DBMS provides comprehensive control mechanisms:</p>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h3>🔒 Security System</h3>
                        <ul>
                            <li>User authentication</li>
                            <li>Access control lists</li>
                            <li>Role-based permissions</li>
                            <li>Encryption support</li>
                        </ul>
                    </div>
                    
                    <div class="demo-box">
                        <h3>✓ Integrity System</h3>
                        <ul>
                            <li>Data validation rules</li>
                            <li>Referential integrity</li>
                            <li>Business rule enforcement</li>
                            <li>Constraint checking</li>
                        </ul>
                    </div>
                </div>
                
                <div class="column">
                    <div class="demo-box">
                        <h3>🔄 Concurrency Control</h3>
                        <ul>
                            <li>Multiple user access</li>
                            <li>Transaction management</li>
                            <li>Lock mechanisms</li>
                            <li>Deadlock prevention</li>
                        </ul>
                    </div>
                    
                    <div class="demo-box">
                        <h3>💾 Recovery Control</h3>
                        <ul>
                            <li>Backup mechanisms</li>
                            <li>Transaction logs</li>
                            <li>Point-in-time recovery</li>
                            <li>Disaster recovery</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="demo-box" style="margin-top: 20px;">
                <h3>📚 User-Accessible Catalog</h3>
                <p>Metadata repository containing descriptions of data structures, constraints, users, and applications.</p>
            </div>
        </div>

        <!-- Slide 7: Database Views -->
        <div class="slide">
            <h1>Database Views</h1>
            <p>Virtual tables based on database queries:</p>

            <div class="demo-box">
                <h3>Benefits of Views:</h3>
                <ul style="font-size: 1.2em; line-height: 1.8;">
                    <li>✓ Reduce complexity for users</li>
                    <li>✓ Provide security through restricted access</li>
                    <li>✓ Customize data appearance per user needs</li>
                    <li>✓ Present consistent picture despite schema changes</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Creating a view for available movies from movie_rental_db</span><br>
                <span class="sql-keyword">CREATE VIEW</span> AvailableMovies <span class="sql-keyword">AS</span><br>
                <span class="sql-keyword">SELECT</span> movie_id, title, director, genre<br>
                <span class="sql-keyword">FROM</span> Movies<br>
                <span class="sql-keyword">WHERE</span> available = <span class="sql-keyword">TRUE</span><br>
                &nbsp;&nbsp;<span class="sql-keyword">AND</span> release_year >= <span class="sql-string">2020</span>;
            </div>

            <div class="tip-box">
                <strong>Design Principle:</strong> Views act as a window into your data, showing only what users need to see.
            </div>
        </div>

        <!-- Slide 8: History of Database Systems -->
        <div class="slide">
            <h1>Evolution of Database Systems</h1>

            <div class="demo-box">
                <h3>First Generation (1960s-1970s)</h3>
                <ul>
                    <li><strong>Hierarchical Model:</strong> Tree-like structure (IBM's IMS)</li>
                    <li><strong>Network Model:</strong> Graph structure (CODASYL)</li>
                    <li>Navigational access to data</li>
                    <li>Complex programming required</li>
                </ul>
            </div>

            <div class="demo-box">
                <h3>Second Generation (1970s-1990s)</h3>
                <ul>
                    <li><strong>Relational Model:</strong> Tables with rows and columns</li>
                    <li>SQL as standard query language</li>
                    <li>Data independence achieved</li>
                    <li>Examples: Oracle, DB2, SQL Server</li>
                </ul>
            </div>

            <div class="demo-box">
                <h3>Third Generation (1990s-Present)</h3>
                <ul>
                    <li><strong>Object-Relational:</strong> Objects + Relations</li>
                    <li><strong>Object-Oriented:</strong> Pure OO databases</li>
                    <li><strong>NoSQL:</strong> Document, Key-Value, Graph databases</li>
                    <li><strong>NewSQL:</strong> Scalable SQL databases</li>
                </ul>
            </div>
        </div>

        <!-- Slide 9: Practice Activity 1 -->
        <div class="slide">
            <h1>Design Challenge <span class="emoji">🏗️</span></h1>
            <h2>Extend Your Movie Rental Database</h2>

            <div class="demo-box">
                <h3>Scenario:</h3>
                <p>Extend your movie_rental_db with new features to support a growing rental business:</p>
                <ul>
                    <li>Add Reviews table: Members can rate and review movies</li>
                    <li>Add Employees table: Track staff who process rentals</li>
                    <li>Add Inventory table: Support multiple copies of each movie</li>
                    <li>Consider: Late fees, membership tiers, reservation system</li>
                </ul>
            </div>

            <div class="comparison-table">
                <div class="column">
                    <h3>Architectural Decisions:</h3>
                    <ul>
                        <li>New entities needed</li>
                        <li>Relationships to existing tables</li>
                        <li>Constraints and keys</li>
                        <li>Data types for new fields</li>
                    </ul>
                </div>
                <div class="column">
                    <h3>Consider:</h3>
                    <ul>
                        <li>Different user access levels</li>
                        <li>Rating validation (1-5 stars)</li>
                        <li>Inventory tracking accuracy</li>
                        <li>Query performance</li>
                    </ul>
                </div>
            </div>

            <div class="tip-box">
                <strong>Discussion:</strong> How do these extensions fit into the three-level architecture? (10 minutes)
            </div>
        </div>

        <!-- Slide 10: Implementation - Reviews Table -->
        <div class="slide">
            <h1>Implementation: Reviews Table <span class="emoji">⭐</span></h1>
            <h2>Adding Customer Feedback to Your Database</h2>

            <div class="demo-box">
                <h3>Business Requirements:</h3>
                <ul style="font-size: 1.1em; line-height: 1.7;">
                    <li>Members can rate movies after renting (1-5 stars)</li>
                    <li>Members can write text reviews</li>
                    <li>Track when reviews were posted</li>
                    <li>Prevent duplicate reviews (one per member per movie)</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Create Reviews table with constraints</span><br>
                <span class="sql-keyword">CREATE TABLE</span> Reviews (<br>
                &nbsp;&nbsp;review_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
                &nbsp;&nbsp;movie_id <span class="sql-keyword">INTEGER NOT NULL</span>,<br>
                &nbsp;&nbsp;member_id <span class="sql-keyword">INTEGER NOT NULL</span>,<br>
                &nbsp;&nbsp;rating <span class="sql-keyword">INTEGER NOT NULL CHECK</span> (rating >= 1 <span class="sql-keyword">AND</span> rating <= 5),<br>
                &nbsp;&nbsp;review_text <span class="sql-keyword">TEXT</span>,<br>
                &nbsp;&nbsp;review_date <span class="sql-keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span>,<br>
                &nbsp;&nbsp;<span class="sql-keyword">FOREIGN KEY</span> (movie_id) <span class="sql-keyword">REFERENCES</span> Movies(movie_id) <span class="sql-keyword">ON DELETE CASCADE</span>,<br>
                &nbsp;&nbsp;<span class="sql-keyword">FOREIGN KEY</span> (member_id) <span class="sql-keyword">REFERENCES</span> Members(member_id) <span class="sql-keyword">ON DELETE CASCADE</span>,<br>
                &nbsp;&nbsp;<span class="sql-keyword">UNIQUE</span>(movie_id, member_id) <span class="sql-comment">-- Prevent duplicate reviews</span><br>
                );
            </div>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h3>Design Decisions:</h3>
                        <ul style="font-size: 1.0em;">
                            <li><strong>CHECK constraint:</strong> Ensures ratings are 1-5</li>
                            <li><strong>UNIQUE constraint:</strong> One review per member/movie</li>
                            <li><strong>CASCADE delete:</strong> Remove reviews if movie/member deleted</li>
                            <li><strong>LEFT JOIN:</strong> Shows all movies even if they have no reviews yet (returns NULL for movies without ratings)</li>
                        </ul>
                    </div>
                </div>
                <div class="column">
                    <div class="demo-box">
                        <h3>Example Query:</h3>
                        <div class="code-example" style="font-size: 0.85em;">
<span class="sql-comment">-- Get average rating per movie</span><br>
<span class="sql-keyword">SELECT</span> m.title,<br>
&nbsp;&nbsp;<span class="sql-keyword">AVG</span>(r.rating) <span class="sql-keyword">AS</span> avg_rating,<br>
&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(r.review_id) <span class="sql-keyword">AS</span> num_reviews<br>
<span class="sql-keyword">FROM</span> Movies m<br>
<span class="sql-keyword">LEFT JOIN</span> Reviews r<br>
&nbsp;&nbsp;<span class="sql-keyword">ON</span> m.movie_id = r.movie_id<br>
<span class="sql-keyword">GROUP BY</span> m.title;
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Slide 11: Implementation - Employees Table -->
        <div class="slide">
            <h1>Implementation: Employees Table <span class="emoji">👨‍💼</span></h1>
            <h2>Tracking Staff Who Process Rentals</h2>

            <div class="demo-box">
                <h3>Business Requirements:</h3>
                <ul style="font-size: 1.1em; line-height: 1.7;">
                    <li>Store employee information (name, contact, hire date)</li>
                    <li>Track which employee processed each rental</li>
                    <li>Support different employee roles (clerk, manager, admin)</li>
                    <li>Enable employee performance analysis</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Create Employees table</span><br>
                <span class="sql-keyword">CREATE TABLE</span> Employees (<br>
                &nbsp;&nbsp;employee_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
                &nbsp;&nbsp;first_name <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span>,<br>
                &nbsp;&nbsp;last_name <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span>,<br>
                &nbsp;&nbsp;email <span class="sql-keyword">VARCHAR</span>(100) <span class="sql-keyword">UNIQUE NOT NULL</span>,<br>
                &nbsp;&nbsp;phone <span class="sql-keyword">VARCHAR</span>(20),<br>
                &nbsp;&nbsp;role <span class="sql-keyword">VARCHAR</span>(20) <span class="sql-keyword">CHECK</span> (role <span class="sql-keyword">IN</span> (<span class="sql-string">'clerk'</span>, <span class="sql-string">'manager'</span>, <span class="sql-string">'admin'</span>)),<br>
                &nbsp;&nbsp;hire_date <span class="sql-keyword">DATE DEFAULT CURRENT_DATE</span>,<br>
                &nbsp;&nbsp;active <span class="sql-keyword">BOOLEAN DEFAULT TRUE</span><br>
                );<br><br>

                <span class="sql-comment">-- Update Rentals table to track employee</span><br>
                <span class="sql-keyword">ALTER TABLE</span> Rentals<br>
                <span class="sql-keyword">ADD COLUMN</span> processed_by <span class="sql-keyword">INTEGER</span>,<br>
                <span class="sql-keyword">ADD FOREIGN KEY</span> (processed_by) <span class="sql-keyword">REFERENCES</span> Employees(employee_id);
            </div>

            <div class="activity-box" style="margin-top: 20px;">
                <h3>🎯 Challenge: Insert Employee Data</h3>
                <p style="font-size: 1.1em; line-height: 1.7;">Before we can query employee data, we need to populate the table! Create INSERT statements to add at least 5 employees to your database.</p>

                <div class="comparison-table" style="margin-top: 15px;">
                    <div class="column">
                        <h4>Requirements:</h4>
                        <ul style="font-size: 1.0em; line-height: 1.6;">
                            <li>Include a mix of roles (clerk, manager, admin)</li>
                            <li>Make sure each has a unique email</li>
                            <li>Include at least one inactive employee</li>
                            <li>Use realistic names and contact info</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h4>Your Choice of Tool:</h4>
                        <ul style="font-size: 1.0em; line-height: 1.6;">
                            <li><strong>DataGrip:</strong> Write INSERT statements in console</li>
                            <li><strong>CLI (psql):</strong> Connect and execute commands</li>
                            <li><strong>Either way:</strong> Practice your INSERT syntax!</li>
                        </ul>
                    </div>
                </div>

                <div class="tip-box" style="margin-top: 15px;">
                    <strong>Hint:</strong> Remember that hire_date and active have DEFAULT values, so you can omit them from your INSERT if you want to use the defaults!
                </div>
            </div>
        </div>

        <!-- Slide 12: Querying Employee Data -->
        <div class="slide">
            <h1>Querying Employee Data <span class="emoji">📊</span></h1>
            <h2>Analyzing Employee Performance Metrics</h2>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h3>Design Decisions:</h3>
                        <ul style="font-size: 1.0em;">
                            <li><strong>Role constraint:</strong> Limit to valid roles</li>
                            <li><strong>Active flag:</strong> Soft delete for terminated employees</li>
                            <li><strong>Email unique:</strong> Prevent duplicate accounts</li>
                        </ul>
                    </div>
                </div>
                <div class="column">
                    <div class="demo-box">
                        <h3>Example Query:</h3>
                        <div class="code-example" style="font-size: 0.85em;">
<span class="sql-comment">-- Employee performance metrics</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;e.first_name || <span class="sql-string">' '</span> || e.last_name <span class="sql-keyword">AS</span> employee,<br>
&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(r.rental_id) <span class="sql-keyword">AS</span> rentals_processed<br>
<span class="sql-keyword">FROM</span> Employees e<br>
<span class="sql-keyword">LEFT JOIN</span> Rentals r<br>
&nbsp;&nbsp;<span class="sql-keyword">ON</span> e.employee_id = r.processed_by<br>
<span class="sql-keyword">WHERE</span> e.active = <span class="sql-keyword">TRUE</span><br>
<span class="sql-keyword">GROUP BY</span> e.employee_id<br>
<span class="sql-keyword">ORDER BY</span> rentals_processed <span class="sql-keyword">DESC</span>;
                        </div>
                    </div>
                </div>
            </div>

            <div class="tip-box" style="margin-top: 20px;">
                <h3>🔍 Understanding the Query:</h3>
                <ul style="font-size: 1.0em; line-height: 1.7;">
                    <li><strong>String Concatenation (||):</strong> The <code>||</code> operator combines strings together. <code>e.first_name || ' ' || e.last_name</code> joins the first name, a space, and the last name into one string (e.g., "John" + " " + "Doe" = "John Doe")</li>
                    <li><strong>Why concatenate?</strong> Instead of displaying two separate columns for first_name and last_name, we create a single, readable "employee" column for reports</li>
                    <li><strong>AS keyword:</strong> Creates an alias (column name) for the result. The concatenated string appears as "employee" in the output</li>
                    <li><strong>GROUP BY requirement:</strong> When using aggregate functions like COUNT(), we must group by the employee_id to calculate rentals per employee</li>
                </ul>
            </div>
        </div>

        <!-- Slide 13: Implementation - Inventories Table -->
        <div class="slide">
            <h1>Implementation: Inventories Table <span class="emoji">📀</span></h1>
            <h2>Supporting Multiple Copies of Each Movie</h2>

            <div class="demo-box">
                <h3>Business Requirements:</h3>
                <ul style="font-size: 1.1em; line-height: 1.7;">
                    <li>Track multiple physical copies of popular movies</li>
                    <li>Each copy has a unique barcode/serial number</li>
                    <li>Monitor condition status (new, good, damaged)</li>
                    <li>Know which specific copy is rented to whom</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Create Inventories table for physical copies</span><br>
                <span class="sql-keyword">CREATE TABLE</span> Inventories (<br>
                &nbsp;&nbsp;copy_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
                &nbsp;&nbsp;movie_id <span class="sql-keyword">INTEGER NOT NULL</span>,<br>
                &nbsp;&nbsp;barcode <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">UNIQUE NOT NULL</span>,<br>
                &nbsp;&nbsp;condition <span class="sql-keyword">VARCHAR</span>(20) <span class="sql-keyword">CHECK</span> (condition <span class="sql-keyword">IN</span> (<span class="sql-string">'new'</span>, <span class="sql-string">'good'</span>, <span class="sql-string">'fair'</span>, <span class="sql-string">'damaged'</span>)),<br>
                &nbsp;&nbsp;acquisition_date <span class="sql-keyword">DATE DEFAULT CURRENT_DATE</span>,<br>
                &nbsp;&nbsp;available <span class="sql-keyword">BOOLEAN DEFAULT TRUE</span>,<br>
                &nbsp;&nbsp;<span class="sql-keyword">FOREIGN KEY</span> (movie_id) <span class="sql-keyword">REFERENCES</span> Movies(movie_id) <span class="sql-keyword">ON DELETE CASCADE</span><br>
                );<br><br>

                <span class="sql-comment">-- Update Rentals to track specific copy</span><br>
                <span class="sql-keyword">ALTER TABLE</span> Rentals<br>
                <span class="sql-keyword">ADD COLUMN</span> copy_id <span class="sql-keyword">INTEGER</span>,<br>
                <span class="sql-keyword">ADD FOREIGN KEY</span> (copy_id) <span class="sql-keyword">REFERENCES</span> Inventories(copy_id);
            </div>

            <div class="activity-box" style="margin-top: 20px;">
                <h3>🎯 Challenge: Insert Inventory Data</h3>
                <p style="font-size: 1.1em; line-height: 1.7;">Create multiple physical copies of your movies! Write INSERT statements to add at least 10 inventory items (copies) to your database.</p>

                <div class="comparison-table" style="margin-top: 15px;">
                    <div class="column">
                        <h4>Requirements:</h4>
                        <ul style="font-size: 1.0em; line-height: 1.6;">
                            <li>Create multiple copies of popular movies (2-3 copies each)</li>
                            <li>Use unique barcodes (e.g., "DVD-001", "DVD-002")</li>
                            <li>Include various conditions (new, good, fair, damaged)</li>
                            <li>Mark some copies as currently unavailable</li>
                        </ul>
                    </div>
                    <div class="column">
                        <h4>Example INSERT:</h4>
                        <div class="code-example" style="font-size: 0.75em;">
<span class="sql-keyword">INSERT INTO</span> Inventories<br>
&nbsp;&nbsp;(movie_id, barcode, condition)<br>
<span class="sql-keyword">VALUES</span><br>
&nbsp;&nbsp;(1, <span class="sql-string">'DVD-001'</span>, <span class="sql-string">'new'</span>),<br>
&nbsp;&nbsp;(1, <span class="sql-string">'DVD-002'</span>, <span class="sql-string">'good'</span>),<br>
&nbsp;&nbsp;(2, <span class="sql-string">'DVD-003'</span>, <span class="sql-string">'new'</span>);
                        </div>
                    </div>
                </div>

                <div class="tip-box" style="margin-top: 15px;">
                    <strong>Tip:</strong> You need to know the movie_id values from your Movies table. Run <code>SELECT movie_id, title FROM Movies;</code> first to see what IDs to use!
                </div>
            </div>
        </div>

        <!-- Slide 14: Querying Inventory Data -->
        <div class="slide">
            <h1>Querying Inventory Data <span class="emoji">📊</span></h1>
            <h2>Analyzing Movie Copies and Availability</h2>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h3>Design Decisions:</h3>
                        <ul style="font-size: 1.0em;">
                            <li><strong>Barcode unique:</strong> Each physical copy identified</li>
                            <li><strong>Condition tracking:</strong> Manage wear and tear</li>
                            <li><strong>Availability flag:</strong> Quick lookup for rentable copies</li>
                        </ul>
                    </div>
                </div>
                <div class="column">
                    <div class="demo-box">
                        <h3>Example Query:</h3>
                        <div class="code-example" style="font-size: 0.85em;">
<span class="sql-comment">-- Available copies per movie</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;m.title,<br>
&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(i.copy_id) <span class="sql-keyword">AS</span> total_copies,<br>
&nbsp;&nbsp;<span class="sql-keyword">SUM</span>(<span class="sql-keyword">CASE WHEN</span> i.available<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">THEN</span> 1 <span class="sql-keyword">ELSE</span> 0 <span class="sql-keyword">END</span>) <span class="sql-keyword">AS</span> available_copies<br>
<span class="sql-keyword">FROM</span> Movies m<br>
<span class="sql-keyword">LEFT JOIN</span> Inventories i<br>
&nbsp;&nbsp;<span class="sql-keyword">ON</span> m.movie_id = i.movie_id<br>
<span class="sql-keyword">GROUP BY</span> m.movie_id, m.title;
                        </div>
                    </div>
                </div>
            </div>

            <div class="tip-box" style="margin-top: 20px;">
                <h3>🔍 Understanding the Query:</h3>
                <ul style="font-size: 1.0em; line-height: 1.7;">
                    <li><strong>COUNT(i.copy_id):</strong> Counts total inventory records for each movie</li>
                    <li><strong>CASE WHEN:</strong> Conditional logic that returns 1 if available is TRUE, otherwise 0</li>
                    <li><strong>SUM(CASE WHEN...):</strong> Adds up all the 1s to count how many copies are available</li>
                    <li><strong>LEFT JOIN:</strong> Shows all movies even if they have no inventory records (returns 0 for counts)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: Late Fees System -->
        <div class="slide">
            <h1>Late Fees System <span class="emoji">💰</span></h1>
            <h2>Tracking and Calculating Overdue Charges</h2>

            <div class="demo-box">
                <h3>Business Scenario:</h3>
                <p style="font-size: 1.1em; line-height: 1.7;">Members must return movies by a due date. If they return late (or don't return at all), we need to calculate and charge late fees automatically.</p>
            </div>

            <div class="sql-example" style="margin-top: 20px;">
                <span class="sql-comment">-- Add late fee tracking to existing Rentals table</span><br>
                <span class="sql-keyword">ALTER TABLE</span> Rentals<br>
                <span class="sql-keyword">ADD COLUMN</span> due_date <span class="sql-keyword">DATE</span>,<br>
                <span class="sql-keyword">ADD COLUMN</span> late_fee <span class="sql-keyword">NUMERIC</span>(6,2) <span class="sql-keyword">DEFAULT</span> 0.00;<br><br>

                <span class="sql-comment">-- Calculate late fees (e.g., $2/day)</span><br>
                <span class="sql-keyword">UPDATE</span> Rentals<br>
                <span class="sql-keyword">SET</span> late_fee = <br>
                &nbsp;&nbsp;<span class="sql-keyword">GREATEST</span>(0, <span class="sql-keyword">CURRENT_DATE</span> - due_date) * 2.00<br>
                <span class="sql-keyword">WHERE</span> return_date <span class="sql-keyword">IS NULL</span><br>
                &nbsp;&nbsp;<span class="sql-keyword">AND</span> due_date < <span class="sql-keyword">CURRENT_DATE</span>;
            </div>

            <div class="demo-box" style="margin-top: 20px;">
                <h3>📖 Understanding the New SQL Concepts:</h3>
                <ul style="font-size: 1.0em; line-height: 1.8;">
                    <li><strong>ALTER TABLE:</strong> Modifies an existing table structure without deleting data. We're adding new columns to the Rentals table that already has data in it.</li>
                    <li><strong>NUMERIC(6,2):</strong> A data type for storing decimal numbers. The (6,2) means 6 total digits with 2 after the decimal point. Perfect for money: $9999.99 maximum.</li>
                    <li><strong>DEFAULT 0.00:</strong> Sets an initial value for the column. All existing and new rows will start with late_fee = 0.00 unless specified otherwise.</li>
                    <li><strong>UPDATE:</strong> Changes data in existing rows (unlike INSERT which creates new rows).</li>
                    <li><strong>CURRENT_DATE:</strong> A built-in function that returns today's date.</li>
                    <li><strong>Date Arithmetic:</strong> <code>CURRENT_DATE - due_date</code> calculates how many days overdue. If due_date was 5 days ago, this returns 5.</li>
                    <li><strong>GREATEST(0, ...):</strong> Returns the larger of two values. Prevents negative fees if the movie isn't overdue yet (e.g., GREATEST(0, -3) = 0).</li>
                    <li><strong>IS NULL:</strong> Checks if a value is NULL (empty). <code>return_date IS NULL</code> means the movie hasn't been returned yet.</li>
                </ul>
            </div>

            <div class="tip-box" style="margin-top: 20px;">
                <strong>Real-World Usage:</strong> This UPDATE query would run automatically every night (scheduled job) to update late fees for all unreturned rentals.
            </div>
        </div>

        <!-- Slide 16: Membership Tiers -->
        <div class="slide">
            <h1>Membership Tiers <span class="emoji">🎟️</span></h1>
            <h2>Different Membership Levels with Benefits</h2>

            <div class="demo-box">
                <h3>Business Scenario:</h3>
                <p style="font-size: 1.1em; line-height: 1.7;">Offer different membership levels (basic, premium, VIP) with varying benefits: more rentals allowed, lower late fees, etc. This encourages members to upgrade!</p>
            </div>

            <div class="sql-example" style="margin-top: 20px;">
                <span class="sql-comment">-- Add membership tier columns to Members table</span><br>
                <span class="sql-keyword">ALTER TABLE</span> Members<br>
                <span class="sql-keyword">ADD COLUMN</span> membership_tier <span class="sql-keyword">VARCHAR</span>(20)<br>
                &nbsp;&nbsp;<span class="sql-keyword">DEFAULT</span> <span class="sql-string">'basic'</span><br>
                &nbsp;&nbsp;<span class="sql-keyword">CHECK</span> (membership_tier <span class="sql-keyword">IN</span> (<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'basic'</span>, <span class="sql-string">'premium'</span>, <span class="sql-string">'vip'</span><br>
                &nbsp;&nbsp;)),<br>
                <span class="sql-keyword">ADD COLUMN</span> max_rentals <span class="sql-keyword">INTEGER DEFAULT</span> 3;<br><br>

                <span class="sql-comment">-- Tier benefits:</span><br>
                <span class="sql-comment">-- basic: 3 movies, $2/day late fee</span><br>
                <span class="sql-comment">-- premium: 5 movies, $1/day late fee</span><br>
                <span class="sql-comment">-- vip: unlimited, no late fees</span>
            </div>

            <div class="demo-box" style="margin-top: 20px;">
                <h3>📖 Understanding the New SQL Concepts:</h3>
                <ul style="font-size: 1.0em; line-height: 1.8;">
                    <li><strong>Multiple ADD COLUMN:</strong> You can add multiple columns in a single ALTER TABLE statement by separating them with commas. More efficient than running ALTER TABLE twice.</li>
                    <li><strong>DEFAULT with CHECK:</strong> You can combine DEFAULT and CHECK constraints on the same column. New members default to 'basic', but the value must be one of the three allowed tiers.</li>
                    <li><strong>CHECK (column IN (...)):</strong> The IN operator checks if a value is in a list. This ensures members can only have tier values of 'basic', 'premium', or 'vip' - nothing else will be accepted.</li>
                    <li><strong>Multi-line formatting:</strong> We can split the CHECK constraint across multiple lines for readability. PostgreSQL doesn't care about whitespace or line breaks inside SQL statements.</li>
                    <li><strong>Business logic in database:</strong> By storing max_rentals in the database, we can enforce rental limits at the database level, not just in application code.</li>
                </ul>
            </div>

            <div class="tip-box" style="margin-top: 20px;">
                <strong>Design Challenge:</strong> How would you handle members upgrading/downgrading membership tiers mid-month? What business rules should apply to their current rentals?
            </div>
        </div>

        <!-- Slide 17: Reservation System -->
        <div class="slide">
            <h1>Reservation System <span class="emoji">📅</span></h1>
            <h2>Allowing Members to Reserve Unavailable Movies</h2>

            <div class="demo-box">
                <h3>Business Scenario:</h3>
                <p style="font-size: 1.1em; line-height: 1.7;">All copies of a popular movie are rented out. Instead of turning members away, let them reserve it! When someone returns the movie, notify the first person in the reservation queue.</p>
            </div>

            <div class="sql-example" style="margin-top: 20px;">
                <span class="sql-comment">-- Create Reservations table</span><br>
                <span class="sql-keyword">CREATE TABLE</span> Reservations (<br>
                &nbsp;&nbsp;reservation_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
                &nbsp;&nbsp;movie_id <span class="sql-keyword">INTEGER NOT NULL</span>,<br>
                &nbsp;&nbsp;member_id <span class="sql-keyword">INTEGER NOT NULL</span>,<br>
                &nbsp;&nbsp;reservation_date <span class="sql-keyword">TIMESTAMP</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DEFAULT CURRENT_TIMESTAMP</span>,<br>
                &nbsp;&nbsp;status <span class="sql-keyword">VARCHAR</span>(20)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">DEFAULT</span> <span class="sql-string">'pending'</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">CHECK</span> (status <span class="sql-keyword">IN</span> (<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'pending'</span>, <span class="sql-string">'ready'</span>, <span class="sql-string">'fulfilled'</span>, <span class="sql-string">'cancelled'</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;)),<br>
                &nbsp;&nbsp;<span class="sql-keyword">FOREIGN KEY</span> (movie_id)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">REFERENCES</span> Movies(movie_id),<br>
                &nbsp;&nbsp;<span class="sql-keyword">FOREIGN KEY</span> (member_id)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">REFERENCES</span> Members(member_id)<br>
                );
            </div>

            <div class="demo-box" style="margin-top: 20px;">
                <h3>📖 Understanding the New SQL Concepts:</h3>
                <ul style="font-size: 1.0em; line-height: 1.8;">
                    <li><strong>TIMESTAMP:</strong> Stores both date AND time (e.g., "2024-03-15 14:30:00"). Unlike DATE which only stores the date, TIMESTAMP includes hours, minutes, and seconds.</li>
                    <li><strong>CURRENT_TIMESTAMP:</strong> Built-in function that returns the current date and time. Automatically records exactly when the reservation was made.</li>
                    <li><strong>Status workflow:</strong> Reservations move through states: 'pending' (waiting) → 'ready' (movie available) → 'fulfilled' (member picked it up) or 'cancelled' (member changed mind).</li>
                    <li><strong>Multi-line CHECK constraint:</strong> We can split the allowed values across multiple lines. Same as <code>CHECK (status IN ('pending', 'ready', 'fulfilled', 'cancelled'))</code> but easier to read.</li>
                    <li><strong>Two FOREIGN KEY constraints:</strong> This table links to both Movies (which movie is reserved) and Members (who made the reservation). This creates relationships between three tables.</li>
                    <li><strong>Multi-line FOREIGN KEY:</strong> Each FOREIGN KEY is split across two lines for readability - same constraint, just formatted nicely.</li>
                </ul>
            </div>

            <div class="warning-box" style="margin-top: 20px;">
                <h3>Advanced Implementation Notes:</h3>
                <ul style="font-size: 1.0em; line-height: 1.6;">
                    <li><strong>Triggers:</strong> Database triggers can automatically change status to 'ready' and send notifications when a reserved movie is returned.</li>
                    <li><strong>Queue system (FIFO):</strong> Use ORDER BY reservation_date to process reservations in first-in, first-out order - fair for all members!</li>
                    <li><strong>Expiration:</strong> If status is 'ready' for more than 48 hours, automatically set to 'cancelled' and offer to next person in queue.</li>
                </ul>
            </div>
        </div>

        <!-- Slide 18: Real-World Example -->
        <div class="slide">
            <h1>Your Movie Rental Database</h1>
            <h2>What You Built in Lecture 2 <span class="emoji">🎬</span></h2>

            <div class="erd-diagram">
                <pre>
┌──────────────┐         ┌──────────────┐         ┌──────────────┐
│   STUDIOS    │         │    MOVIES    │         │   MEMBERS    │
├──────────────┤         ├──────────────┤         ├──────────────┤
│ studio_id PK │◄────┐   │ movie_id  PK │   ┌────►│ member_id PK │
│ name         │     │   │ title        │   │     │ name         │
│ country      │     │   │ director     │   │     │ email        │
│ founded_year │     └───│ studio_id FK │   │     │ join_date    │
└──────────────┘         │ release_year │   │     └──────────────┘
                         │ genre        │   │
                         │ rating       │   │
                         │ available    │   │
                         └──────┬───────┘   │
                                │ 1:N       │ 1:N
                                │           │
                                └─────┬─────┘
                                      │
                                      ▼
                               ┌──────────────┐
                               │   RENTALS    │
                               ├──────────────┤
                               │ rental_id PK │
                               │ movie_id  FK │
                               │ member_id FK │
                               │ rental_date  │
                               │ return_date  │
                               └──────────────┘
                </pre>
            </div>

            <div class="demo-box">
                <h3>Architecture Considerations:</h3>
                <ul>
                    <li><strong>External Level:</strong> Different views for members, employees, managers</li>
                    <li><strong>Conceptual Level:</strong> 4 entities with clear relationships</li>
                    <li><strong>Internal Level:</strong> Indexed on frequently searched fields (genre, studio)</li>
                    <li><strong>Scalability:</strong> Ready to add Reviews, Inventory, Employees</li>
                </ul>
            </div>
        </div>

        <!-- Slide 15: DBMS Components -->
        <div class="slide">
            <h1>Major DBMS Components</h1>

            <div class="erd-diagram" style="padding: 20px;">
                <pre style="text-align: center;">
                    ┌──────────────────────┐
                    │   Query Processor    │
                    ├──────────────────────┤
                    │ • Parser             │
                    │ • Optimizer          │
                    │ • Executor           │
                    └──────────┬───────────┘
                              │
                    ┌──────────▼───────────┐
                    │  Storage Manager     │
                    ├──────────────────────┤
                    │ • Buffer Manager     │
                    │ • File Manager       │
                    │ • Index Manager      │
                    └──────────┬───────────┘
                              │
                    ┌──────────▼───────────┐
                    │  Transaction Manager │
                    ├──────────────────────┤
                    │ • Concurrency Control│
                    │ • Recovery Manager   │
                    │ • Lock Manager       │
                    └──────────────────────┘
                </pre>
            </div>
        </div>

        <!-- Slide 16: Practice Activity 2 -->
        <div class="slide">
            <h1>Group Exercise: Architecture Design</h1>

            <div class="demo-box">
                <h3>Task: Design Views for Different Users</h3>
                <p>For your movie_rental_db, create appropriate views for each user role:</p>
            </div>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h4>👔 Managers</h4>
                        <ul>
                            <li>Revenue analytics by movie/genre</li>
                            <li>Member statistics and trends</li>
                            <li>Inventory and availability reports</li>
                            <li>Employee performance metrics</li>
                        </ul>
                    </div>

                    <div class="demo-box">
                        <h4>👨‍💼 Employees</h4>
                        <ul>
                            <li>Current rental transactions</li>
                            <li>Member contact information</li>
                            <li>Movie availability status</li>
                            <li>Overdue rentals to follow up</li>
                        </ul>
                    </div>
                </div>

                <div class="column">
                    <div class="demo-box">
                        <h4>🎬 Members (Logged In)</h4>
                        <ul>
                            <li>Their rental history</li>
                            <li>Available movies to rent</li>
                            <li>Movie ratings and reviews</li>
                            <li>Their account details</li>
                        </ul>
                    </div>

                    <div class="demo-box">
                        <h4>👤 Guests (Public)</h4>
                        <ul>
                            <li>Browse available movies (no prices)</li>
                            <li>Movie titles, genres, ratings</li>
                            <li>Studio information</li>
                            <li>Join membership link</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tip-box">
                <strong>Consider:</strong> What data should be hidden from each user group? How do we protect member privacy and business data?
            </div>
        </div>

        <!-- Slide 17: Modern Database Architectures -->
        <div class="slide">
            <h1>Modern Database Architectures</h1>

            <div class="demo-box">
                <h3>Cloud-Based Architectures</h3>
                <ul>
                    <li><strong>SaaS:</strong> Software as a Service (Salesforce)</li>
                    <li><strong>PaaS:</strong> Platform as a Service (Azure SQL)</li>
                    <li><strong>DBaaS:</strong> Database as a Service (AWS RDS)</li>
                    <li>Elastic scaling and pay-per-use models</li>
                </ul>
            </div>

            <div class="demo-box">
                <h3>Distributed Architectures</h3>
                <ul>
                    <li><strong>Sharding:</strong> Horizontal partitioning</li>
                    <li><strong>Replication:</strong> Multiple copies for availability</li>
                    <li><strong>Federation:</strong> Split databases by function</li>
                    <li><strong>CAP Theorem:</strong> Consistency, Availability, Partition tolerance</li>
                </ul>
            </div>

            <div class="demo-box">
                <h3>Microservices Architecture</h3>
                <ul>
                    <li>Database per service pattern</li>
                    <li>Event sourcing and CQRS</li>
                    <li>Polyglot persistence</li>
                </ul>
            </div>
        </div>

        <!-- IN-CLASS EXERCISES SECTION -->

        <!-- Slide 18: Exercise Overview -->
        <div class="slide">
            <h1>In-Class Exercises <span class="emoji">🏗️</span></h1>
            <h2>Architecture Mapping & Debate <span class="timer-badge">40 minutes</span></h2>

            <div class="demo-box">
                <h3>Exercise Overview</h3>
                <p style="font-size: 1.2em;">Today, you'll apply your understanding of database architecture through two practical exercises. You'll map system components and debate architectural trade-offs for real-world scenarios.</p>
            </div>

            <div class="activity-box">
                <h3>Learning Objectives</h3>
                <ul style="font-size: 1.15em;">
                    <li>✅ Label and explain components within a three-tier architecture</li>
                    <li>✅ Understand the role and function of the DBMS in system architecture</li>
                    <li>✅ Compare centralized vs. distributed database architectures</li>
                    <li>✅ Analyze performance and maintenance trade-offs</li>
                    <li>✅ Justify architectural decisions based on requirements</li>
                </ul>
            </div>

            <button data-timer="40">Start 40-Minute Timer</button>
        </div>

        <!-- Slide 19: Exercise 1 - System Component Mapping -->
        <div class="slide">
            <h1>Exercise 1: System Component Mapping <span class="timer-badge">20 min</span></h1>
            <h2>Individual Exercise: Three-Tier Architecture</h2>

            <div class="exercise-step">
                <h3>Scenario:</h3>
                <p style="font-size: 1.1em;">You are a database architect presenting a system design to stakeholders. You need to clearly explain how data flows through a three-tier web application architecture.</p>
            </div>

            <div class="demo-box">
                <h3>The Three-Tier Architecture Diagram:</h3>
                <div class="erd-diagram" style="font-size: 0.9em;">
                    <pre>
┌────────────────────────────────────────────────────┐
│              Tier 1: Presentation                  │
│  ┌──────────────────────────────────────────────┐  │
│  │         Web Browser (Client)                 │  │
│  │  • HTML/CSS/JavaScript                       │  │
│  │  • User Interface                            │  │
│  │  • ???  (Label A - What happens here?)       │  │
│  └──────────────┬───────────────────────────────┘  │
└─────────────────┼───────────────────────────────────┘
                  │ HTTP/HTTPS Requests
                  ▼
┌────────────────────────────────────────────────────┐
│           Tier 2: Application Server               │
│  ┌──────────────────────────────────────────────┐  │
│  │   Application Server (Node.js/Java/Python)   │  │
│  │  • Business Logic                            │  │
│  │  • ???  (Label B - What component?)          │  │
│  │  • Session Management                        │  │
│  │  • ???  (Label C - What happens here?)       │  │
│  └──────────────┬───────────────────────────────┘  │
└─────────────────┼───────────────────────────────────┘
                  │ SQL Queries
                  ▼
┌────────────────────────────────────────────────────┐
│           Tier 3: Database Server                  │
│  ┌──────────────────────────────────────────────┐  │
│  │          DBMS (MySQL/PostgreSQL)             │  │
│  │  • ???  (Label D - Core function?)           │  │
│  │  • Transaction Management                    │  │
│  │  • Security & Access Control                 │  │
│  └──────────────┬───────────────────────────────┘  │
│                 │                                   │
│  ┌──────────────▼───────────────────────────────┐  │
│  │         Physical Database Files              │  │
│  │  • ???  (Label E - What's stored here?)      │  │
│  └──────────────────────────────────────────────┘  │
└────────────────────────────────────────────────────┘
                    </pre>
                </div>
            </div>
        </div>

        <!-- Slide 20: Understanding Exercise 1 -->
        <div class="slide">
            <h1>Understanding: Three-Tier Architecture <span class="emoji">🔍</span></h1>

            <div class="demo-box">
                <h3>Expected Labels:</h3>
                <table class="table-schema" style="font-size: 0.95em;">
                    <tr>
                        <th>Label</th>
                        <th>Component</th>
                        <th>Function</th>
                    </tr>
                    <tr>
                        <td><strong>A</strong></td>
                        <td>Render UI & Capture Input</td>
                        <td>Display data to user, capture form submissions and clicks</td>
                    </tr>
                    <tr>
                        <td><strong>B</strong></td>
                        <td>API/Web Framework</td>
                        <td>RESTful APIs, routing, request handling</td>
                    </tr>
                    <tr>
                        <td><strong>C</strong></td>
                        <td>Data Validation & Business Rules</td>
                        <td>Validate input, apply business logic before querying DB</td>
                    </tr>
                    <tr>
                        <td><strong>D</strong></td>
                        <td>Query Processing & Execution</td>
                        <td>Parse SQL, optimize queries, execute against physical storage</td>
                    </tr>
                    <tr>
                        <td><strong>E</strong></td>
                        <td>Tables, Indexes, Logs</td>
                        <td>Physical storage of data structures, indexes for fast lookup</td>
                    </tr>
                </table>
            </div>

            <div class="demo-box">
                <h3>The DBMS Role:</h3>
                <p style="font-size: 1.05em;">The DBMS serves as a <strong>sophisticated intermediary</strong> that:</p>
                <ul style="font-size: 1.05em; line-height: 1.7;">
                    <li>Translates high-level SQL queries into low-level file operations</li>
                    <li>Optimizes query execution paths for performance</li>
                    <li>Manages concurrent access from multiple application server instances</li>
                    <li>Enforces data integrity constraints and security policies</li>
                    <li>Provides transaction guarantees (ACID properties)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 21: Real-World Three-Tier Examples -->
        <div class="slide">
            <h1>Real-World Example: Movie Rental Web App <span class="emoji">🌐</span></h1>
            <h2>Three-Tier Architecture in Action</h2>

            <div class="demo-box">
                <h3>Tier 1: Presentation Layer (Browser)</h3>
                <div class="code-example" style="font-size: 0.85em; margin-top: 10px;">
<span class="sql-comment">// React component displaying available movies</span><br>
function MovieCatalog() {<br>
&nbsp;&nbsp;const [movies, setMovies] = useState([]);<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;// Fetch data from application server<br>
&nbsp;&nbsp;fetch('/api/movies/available')<br>
&nbsp;&nbsp;&nbsp;&nbsp;.then(response => response.json())<br>
&nbsp;&nbsp;&nbsp;&nbsp;.then(data => setMovies(data));<br>
}
                </div>
            </div>

            <div class="demo-box">
                <h3>Tier 2: Application Server (Node.js/Express)</h3>
                <div class="code-example" style="font-size: 0.85em; margin-top: 10px;">
<span class="sql-comment">// API endpoint with business logic</span><br>
app.get('/api/movies/available', async (req, res) => {<br>
&nbsp;&nbsp;// Validate user session<br>
&nbsp;&nbsp;if (!req.session.userId) return res.status(401);<br>
&nbsp;&nbsp;<br>
&nbsp;&nbsp;// Query database<br>
&nbsp;&nbsp;const movies = await db.query(<br>
&nbsp;&nbsp;&nbsp;&nbsp;'SELECT * FROM Movies WHERE available = TRUE'<br>
&nbsp;&nbsp;);<br>
&nbsp;&nbsp;res.json(movies);<br>
});
                </div>
            </div>

            <div class="demo-box">
                <h3>Tier 3: Database (PostgreSQL)</h3>
                <ul style="font-size: 1.05em; line-height: 1.7;">
                    <li><strong>DBMS parses</strong> the SQL query</li>
                    <li><strong>Query optimizer</strong> decides to use index on 'available' column</li>
                    <li><strong>Execution engine</strong> retrieves rows from physical storage</li>
                    <li><strong>Returns result set</strong> to application server</li>
                </ul>
            </div>
        </div>

        <!-- Slide 22: Exercise 2 - DBMS Internals -->
        <div class="slide">
            <h1>Exercise: Explore DBMS Internals <span class="timer-badge">20 min</span></h1>
            <h2>Individual Hands-On: See Behind the Scenes</h2>

            <div class="demo-box">
                <h3>Why This Exercise?</h3>
                <p style="font-size: 1.1em;">Instead of debating theoretical concepts, let's <strong>directly interact</strong> with the DBMS to see how it actually works under the hood. You'll explore the mechanisms that make database architecture possible.</p>
            </div>

            <div class="activity-box">
                <h3>What You'll Discover:</h3>
                <ul style="font-size: 1.1em; line-height: 1.8;">
                    <li>🔍 <strong>System Catalog:</strong> How the DBMS stores metadata about your database</li>
                    <li>🔒 <strong>Locks & Concurrency:</strong> How the DBMS prevents data conflicts</li>
                    <li>📊 <strong>Transaction Management:</strong> How ACID properties work in practice</li>
                    <li>⚡ <strong>Query Execution:</strong> How the DBMS processes your queries internally</li>
                </ul>
            </div>

            <div class="warning-box">
                <h3>Tools Needed:</h3>
                <p>DataGrip connected to your movie_rental_db, or PostgreSQL CLI (psql)</p>
            </div>

            <button data-timer="20">Start 20-Minute Timer</button>
        </div>

        <!-- Slide 23: Part 1 - System Catalog Exploration -->
        <div class="slide">
            <h1>Part 1: System Catalog Exploration <span class="emoji">🔍</span></h1>
            <h2>How Does the DBMS Know About Your Tables?</h2>

            <div class="demo-box">
                <h3>The System Catalog</h3>
                <p style="font-size: 1.05em;">Every DBMS maintains internal tables (metadata) describing your database structure. PostgreSQL stores this in the <code>pg_catalog</code> schema.</p>
            </div>

            <div class="activity-box">
                <h3>Task 1: Explore Your Database Metadata (5 minutes)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Run these queries to see what the DBMS knows about your movie_rental_db:</p>

                <div class="sql-example" style="font-size: 0.85em; margin-top: 10px;">
<span class="sql-comment">-- Query 1: List all tables in your database</span><br>
<span class="sql-keyword">SELECT</span> tablename, schemaname<br>
<span class="sql-keyword">FROM</span> pg_tables<br>
<span class="sql-keyword">WHERE</span> schemaname = <span class="sql-string">'public'</span>;
                </div>

                <div class="sql-example" style="font-size: 0.85em; margin-top: 15px;">
<span class="sql-comment">-- Query 2: View columns for Movies table</span><br>
<span class="sql-keyword">SELECT</span> column_name, data_type, is_nullable, column_default<br>
<span class="sql-keyword">FROM</span> information_schema.columns<br>
<span class="sql-keyword">WHERE</span> table_name = <span class="sql-string">'movies'</span>;
                </div>

                <div class="sql-example" style="font-size: 0.85em; margin-top: 15px;">
<span class="sql-comment">-- Query 3: List all indexes on your tables</span><br>
<span class="sql-keyword">SELECT</span> tablename, indexname, indexdef<br>
<span class="sql-keyword">FROM</span> pg_indexes<br>
<span class="sql-keyword">WHERE</span> schemaname = <span class="sql-string">'public'</span>;
                </div>
            </div>

            <div class="tip-box">
                <strong>Key Insight:</strong> The DBMS stores metadata about YOUR data! This is how it enforces constraints and optimizes queries.
            </div>
        </div>

        <!-- Slide 24: Part 2 - Transaction Management -->
        <div class="slide">
            <h1>Part 2: Transaction Management <span class="emoji">🔄</span></h1>
            <h2>Experience ACID Properties in Action</h2>

            <div class="demo-box">
                <h3>What is a Transaction?</h3>
                <p style="font-size: 1.05em;">A transaction is a logical unit of work that must be completed entirely or not at all (Atomicity). Let's see this in action!</p>
            </div>

            <div class="activity-box">
                <h3>Task 2: Test Transaction Rollback (5 minutes)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Simulate a failed rental transaction:</p>

                <div class="sql-example" style="font-size: 0.8em; margin-top: 10px;">
<span class="sql-comment">-- Start a transaction block</span><br>
<span class="sql-keyword">BEGIN</span>;<br><br>

<span class="sql-comment">-- Attempt to rent a movie (update inventory)</span><br>
<span class="sql-keyword">UPDATE</span> Movies<br>
<span class="sql-keyword">SET</span> available = <span class="sql-keyword">FALSE</span><br>
<span class="sql-keyword">WHERE</span> movie_id = <span class="sql-string">1</span>;<br><br>

<span class="sql-comment">-- Check current state (movie should be unavailable)</span><br>
<span class="sql-keyword">SELECT</span> movie_id, title, available<br>
<span class="sql-keyword">FROM</span> Movies<br>
<span class="sql-keyword">WHERE</span> movie_id = <span class="sql-string">1</span>;<br><br>

<span class="sql-comment">-- Oops! Customer's credit card declined - ROLLBACK</span><br>
<span class="sql-keyword">ROLLBACK</span>;<br><br>

<span class="sql-comment">-- Check state again (movie should be available again!)</span><br>
<span class="sql-keyword">SELECT</span> movie_id, title, available<br>
<span class="sql-keyword">FROM</span> Movies<br>
<span class="sql-keyword">WHERE</span> movie_id = <span class="sql-string">1</span>;
                </div>
            </div>

            <div class="success-box">
                <h3>What Happened?</h3>
                <p style="font-size: 1.0em;">The DBMS <strong>undid</strong> your changes! This is the "Atomicity" in ACID - all or nothing.</p>
            </div>
        </div>

        <!-- Slide 25: Part 3 - Concurrency & Locks -->
        <div class="slide">
            <h1>Part 3: Concurrency & Locks <span class="emoji">🔒</span></h1>
            <h2>How Does the DBMS Handle Multiple Users?</h2>

            <div class="demo-box">
                <h3>The Concurrency Challenge</h3>
                <p style="font-size: 1.05em;">When two customers try to rent the last copy of a movie simultaneously, how does the DBMS prevent conflicts?</p>
            </div>

            <div class="activity-box">
                <h3>Task 3: View Active Locks (5 minutes)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Open TWO DataGrip console windows (or two psql sessions):</p>

                <div class="comparison-table">
                    <div class="column">
                        <div class="demo-box">
                            <h4>Session 1 (Window 1):</h4>
                            <div class="code-example" style="font-size: 0.75em;">
<span class="sql-comment">-- Start transaction</span><br>
<span class="sql-keyword">BEGIN</span>;<br><br>

<span class="sql-comment">-- Update a movie</span><br>
<span class="sql-keyword">UPDATE</span> Movies<br>
<span class="sql-keyword">SET</span> available = <span class="sql-keyword">FALSE</span><br>
<span class="sql-keyword">WHERE</span> movie_id = <span class="sql-string">1</span>;<br><br>

<span class="sql-comment">-- DON'T COMMIT YET!</span><br>
<span class="sql-comment">-- Leave transaction open</span>
                            </div>
                        </div>
                    </div>

                    <div class="column">
                        <div class="demo-box">
                            <h4>Session 2 (Window 2):</h4>
                            <div class="code-example" style="font-size: 0.75em;">
<span class="sql-comment">-- View current locks</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;locktype,<br>
&nbsp;&nbsp;relation::regclass,<br>
&nbsp;&nbsp;mode,<br>
&nbsp;&nbsp;granted<br>
<span class="sql-keyword">FROM</span> pg_locks<br>
<span class="sql-keyword">WHERE</span> relation::regclass::text<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;= <span class="sql-string">'movies'</span>;
                            </div>
                        </div>
                    </div>
                </div>

                <p style="font-size: 0.95em; margin-top: 15px;"><strong>What you'll see:</strong> Session 1 holds a lock on the Movies table! This prevents other transactions from interfering.</p>
            </div>

            <div class="tip-box">
                <strong>Remember:</strong> Run COMMIT or ROLLBACK in Session 1 to release the lock when done!
            </div>
        </div>

        <!-- Slide 26: Part 4 - Query Processing -->
        <div class="slide">
            <h1>Part 4: Query Processing Internals <span class="emoji">⚡</span></h1>
            <h2>How Does the DBMS Execute Your Queries?</h2>

            <div class="demo-box">
                <h3>Behind Every Query</h3>
                <p style="font-size: 1.05em;">When you run a SQL query, the DBMS performs multiple steps: parsing, planning, optimization, and execution.</p>
            </div>

            <div class="activity-box">
                <h3>Task 4: View Query Execution Statistics (5 minutes)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">PostgreSQL tracks statistics about query execution:</p>

                <div class="sql-example" style="font-size: 0.8em; margin-top: 10px;">
<span class="sql-comment">-- View query statistics for Movies table</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;schemaname,<br>
&nbsp;&nbsp;tablename,<br>
&nbsp;&nbsp;seq_scan <span class="sql-keyword">AS</span> sequential_scans,<br>
&nbsp;&nbsp;seq_tup_read <span class="sql-keyword">AS</span> rows_read_seq,<br>
&nbsp;&nbsp;idx_scan <span class="sql-keyword">AS</span> index_scans,<br>
&nbsp;&nbsp;idx_tup_fetch <span class="sql-keyword">AS</span> rows_fetched_idx,<br>
&nbsp;&nbsp;n_tup_ins <span class="sql-keyword">AS</span> inserts,<br>
&nbsp;&nbsp;n_tup_upd <span class="sql-keyword">AS</span> updates,<br>
&nbsp;&nbsp;n_tup_del <span class="sql-keyword">AS</span> deletes<br>
<span class="sql-keyword">FROM</span> pg_stat_user_tables<br>
<span class="sql-keyword">WHERE</span> tablename = <span class="sql-string">'movies'</span>;
                </div>

                <div class="sql-example" style="font-size: 0.8em; margin-top: 15px;">
<span class="sql-comment">-- See how many times each index has been used</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;indexrelname <span class="sql-keyword">AS</span> index_name,<br>
&nbsp;&nbsp;idx_scan <span class="sql-keyword">AS</span> times_used,<br>
&nbsp;&nbsp;idx_tup_read <span class="sql-keyword">AS</span> tuples_read,<br>
&nbsp;&nbsp;idx_tup_fetch <span class="sql-keyword">AS</span> tuples_fetched<br>
<span class="sql-keyword">FROM</span> pg_stat_user_indexes<br>
<span class="sql-keyword">WHERE</span> schemaname = <span class="sql-string">'public'</span>;
                </div>
            </div>

            <div class="success-box">
                <h3>Key Insight:</h3>
                <p style="font-size: 1.0em;">The DBMS tracks EVERY operation! This data helps it optimize future queries and helps DBAs tune performance.</p>
            </div>
        </div>

        <!-- Slide 26: DBMS Exploration Summary -->
        <div class="slide">
            <h1>DBMS Internals: What You Discovered <span class="emoji">🎯</span></h1>

            <div class="comparison-table">
                <div class="column">
                    <div class="demo-box">
                        <h3>System Catalog</h3>
                        <ul style="font-size: 0.95em; line-height: 1.6;">
                            <li>DBMS stores metadata about tables, columns, indexes</li>
                            <li>You can query this metadata like any other data</li>
                            <li>This enables dynamic schema inspection</li>
                        </ul>
                    </div>

                    <div class="demo-box">
                        <h3>Transactions</h3>
                        <ul style="font-size: 0.95em; line-height: 1.6;">
                            <li>BEGIN, COMMIT, ROLLBACK control transaction boundaries</li>
                            <li>Atomicity ensures all-or-nothing execution</li>
                            <li>Protects data integrity during failures</li>
                        </ul>
                    </div>
                </div>

                <div class="column">
                    <div class="demo-box">
                        <h3>Concurrency Control</h3>
                        <ul style="font-size: 0.95em; line-height: 1.6;">
                            <li>DBMS uses locks to prevent conflicts</li>
                            <li>You can view active locks in pg_locks</li>
                            <li>Isolation ensures transactions don't interfere</li>
                        </ul>
                    </div>

                    <div class="demo-box">
                        <h3>Query Processing</h3>
                        <ul style="font-size: 0.95em; line-height: 1.6;">
                            <li>DBMS tracks execution statistics</li>
                            <li>Helps optimize query performance</li>
                            <li>Shows which indexes are actually used</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div class="tip-box">
                <strong>Architecture Connection:</strong> These mechanisms implement the DBMS controlled access features we discussed earlier - security, integrity, concurrency, and recovery!
            </div>
        </div>

        <!-- HOMEWORK SECTION -->

        <!-- Slide 27: Homework Overview -->
        <div class="slide">
            <h1>Homework Assignment <span class="emoji">🛠️</span></h1>
            <h2>Week 3: Hands-On Database Architecture</h2>

            <div class="demo-box">
                <h3>Assignment Overview</h3>
                <p style="font-size: 1.15em;">This week's homework is <strong>100% hands-on work in DataGrip</strong>. You'll explore database architecture, implement multi-schema designs, and analyze query performance—all practical skills used by real database architects.</p>
            </div>

            <div class="success-box">
                <h3>🎯 What You'll Learn:</h3>
                <ul style="font-size: 1.05em; line-height: 1.7;">
                    <li>Document physical database architecture using DataGrip's tools</li>
                    <li>Implement architectural layers using PostgreSQL schemas</li>
                    <li>Analyze query execution plans and optimization strategies</li>
                    <li>Understand security architecture through role-based access control</li>
                </ul>
            </div>

            <div class="warning-box">
                <h3>Due Date: <strong>Before Class Next Week</strong></h3>
                <p>Submit screenshots + SQL scripts via GitHub commit URL to D2L</p>
            </div>

            <div class="activity-box">
                <h3>Assignment Components:</h3>
                <ol style="font-size: 1.15em; line-height: 1.8;">
                    <li><strong>Part 1:</strong> Architecture Discovery & Documentation (40 points)</li>
                    <li><strong>Part 2:</strong> Multi-Schema Architecture Implementation (40 points)</li>
                    <li><strong>Part 3:</strong> Query Performance Analysis (20 points)</li>
                </ol>
                <p style="margin-top: 15px; font-size: 1.1em;"><strong>Total Points: 100</strong></p>
            </div>

            <div class="tip-box">
                <strong>No Writing Required!</strong> This assignment is all practical SQL and DataGrip work with screenshot documentation.
            </div>
        </div>

        <!-- Slide 28: Part 1 - Architecture Discovery -->
        <div class="slide">
            <h1>Part 1: Architecture Discovery (40 pts)</h1>
            <h2>Explore Your Movie Rental Database in DataGrip</h2>

            <div class="exercise-step">
                <h3>Task Overview:</h3>
                <p style="font-size: 1.15em;">Use DataGrip to thoroughly document the <strong>physical and logical architecture</strong> of your movie_rental_db from Lecture 2. You'll extract information that database architects use daily.</p>
            </div>

            <div class="activity-box">
                <h3>Step 1: Generate Database Documentation (10 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">In DataGrip, right-click your movie_rental_db database:</p>
                <ol style="font-size: 1.0em; line-height: 1.7;">
                    <li>Select <strong>Diagrams → Show Visualization</strong></li>
                    <li>Arrange tables to show relationships clearly</li>
                    <li>Export diagram as PNG: <code>movie_rental_erd_diagram.png</code></li>
                    <li><strong>Required:</strong> Diagram must show all tables, PKs, FKs, and relationships</li>
                </ol>
            </div>

            <div class="activity-box">
                <h3>Step 2: Extract Physical Schema (15 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Document the complete DDL (Data Definition Language):</p>
                <ol style="font-size: 1.0em; line-height: 1.7;">
                    <li>In DataGrip, select all your tables (Movies, Members, Rentals, Studios)</li>
                    <li>Right-click → SQL Scripts → DDL</li>
                    <li>Copy the complete CREATE TABLE statements</li>
                    <li>Save to file: <code>movie_rental_schema.sql</code></li>
                    <li><strong>Include:</strong> All constraints (PRIMARY KEY, FOREIGN KEY, NOT NULL, UNIQUE)</li>
                </ol>
            </div>

            <div class="activity-box">
                <h3>Step 3: Analyze Data Types & Constraints (15 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Create a documentation table:</p>
                <div class="sql-example" style="font-size: 0.8em; margin-top: 10px;">
<span class="sql-comment">-- Create this table in your database and populate it</span><br>
<span class="sql-keyword">CREATE TABLE</span> architecture_analysis (<br>
&nbsp;&nbsp;table_name <span class="sql-keyword">VARCHAR</span>(50),<br>
&nbsp;&nbsp;column_name <span class="sql-keyword">VARCHAR</span>(50),<br>
&nbsp;&nbsp;data_type <span class="sql-keyword">VARCHAR</span>(50),<br>
&nbsp;&nbsp;constraint_type <span class="sql-keyword">VARCHAR</span>(50),<br>
&nbsp;&nbsp;architectural_purpose <span class="sql-keyword">TEXT</span><br>
);
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;">For each column in your tables, document WHY that data type and constraint were chosen from an architecture perspective.</p>
            </div>

            <div class="tip-box">
                <strong>Screenshot Required:</strong> Capture DataGrip showing your ER diagram with all relationships visible
            </div>
        </div>

        <!-- Slide 29: Part 2 - Multi-Schema Architecture -->
        <div class="slide">
            <h1>Part 2: Multi-Schema Architecture (40 pts)</h1>
            <h2>Implement Architectural Layers</h2>

            <div class="exercise-step">
                <h3>Task Overview:</h3>
                <p style="font-size: 1.15em;">Create a <strong>multi-schema architecture</strong> that simulates how real applications separate concerns across different architectural layers. You'll use PostgreSQL schemas to represent staging, production, and reporting tiers.</p>
            </div>

            <div class="activity-box">
                <h3>Step 1: Create Architectural Schemas (10 pts)</h3>
                <div class="sql-example" style="font-size: 0.85em;">
<span class="sql-comment">-- Create three schemas representing different architectural layers</span><br>
<span class="sql-keyword">CREATE SCHEMA</span> staging;<br>
<span class="sql-keyword">CREATE SCHEMA</span> production;<br>
<span class="sql-keyword">CREATE SCHEMA</span> reporting;
                </div>
                <p style="font-size: 1.0em; margin-top: 10px;">Each schema serves a different architectural purpose:</p>
                <ul style="font-size: 0.95em; line-height: 1.6;">
                    <li><strong>staging:</strong> Data validation and transformation layer</li>
                    <li><strong>production:</strong> Live operational data</li>
                    <li><strong>reporting:</strong> Read-only views for analytics</li>
                </ul>
            </div>

            <div class="activity-box">
                <h3>Step 2: Implement Tables in Each Layer (15 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Recreate your Movies and Members tables in each schema:</p>
                <div class="sql-example" style="font-size: 0.8em;">
<span class="sql-keyword">CREATE TABLE</span> staging.movies (<br>
&nbsp;&nbsp;movie_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
&nbsp;&nbsp;title <span class="sql-keyword">VARCHAR</span>(200),<br>
&nbsp;&nbsp;director <span class="sql-keyword">VARCHAR</span>(100),<br>
&nbsp;&nbsp;data_quality_flag <span class="sql-keyword">VARCHAR</span>(20), <span class="sql-comment">-- NEW: Track validation status</span><br>
&nbsp;&nbsp;import_timestamp <span class="sql-keyword">TIMESTAMP DEFAULT CURRENT_TIMESTAMP</span><br>
);<br><br>

<span class="sql-keyword">CREATE TABLE</span> production.movies (<br>
&nbsp;&nbsp;movie_id <span class="sql-keyword">SERIAL PRIMARY KEY</span>,<br>
&nbsp;&nbsp;title <span class="sql-keyword">VARCHAR</span>(200) <span class="sql-keyword">NOT NULL</span>,<br>
&nbsp;&nbsp;director <span class="sql-keyword">VARCHAR</span>(100) <span class="sql-keyword">NOT NULL</span>,<br>
&nbsp;&nbsp;genre <span class="sql-keyword">VARCHAR</span>(50) <span class="sql-keyword">NOT NULL</span><br>
);
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;"><strong>Note:</strong> Staging has relaxed constraints; Production enforces strict rules</p>
            </div>

            <div class="activity-box">
                <h3>Step 3: Create Reporting Views (15 pts)</h3>
                <div class="sql-example" style="font-size: 0.8em;">
<span class="sql-comment">-- Create abstraction layer for reporting tier</span><br>
<span class="sql-keyword">CREATE VIEW</span> reporting.movie_summary <span class="sql-keyword">AS</span><br>
<span class="sql-keyword">SELECT</span><br>
&nbsp;&nbsp;m.title,<br>
&nbsp;&nbsp;m.director,<br>
&nbsp;&nbsp;<span class="sql-keyword">COUNT</span>(r.rental_id) <span class="sql-keyword">AS</span> times_rented<br>
<span class="sql-keyword">FROM</span> production.movies m<br>
<span class="sql-keyword">LEFT JOIN</span> production.rentals r <span class="sql-keyword">ON</span> m.movie_id = r.movie_id<br>
<span class="sql-keyword">GROUP BY</span> m.title, m.director;
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;">Create 2 additional views that represent different "presentation layer" perspectives</p>
            </div>

            <div class="tip-box">
                <strong>Screenshot Required:</strong> DataGrip sidebar showing all three schemas with their objects
            </div>
        </div>

        <!-- Slide 30: Part 3 - Query Performance Analysis -->
        <div class="slide">
            <h1>Part 3: Query Performance Analysis (20 pts)</h1>
            <h2>Understand Query Optimization Architecture</h2>

            <div class="exercise-step">
                <h3>Task Overview:</h3>
                <p style="font-size: 1.15em;">Use PostgreSQL's <strong>EXPLAIN ANALYZE</strong> to understand how the DBMS makes architectural decisions about query execution. You'll compare performance with and without indexes—a key architectural optimization.</p>
            </div>

            <div class="activity-box">
                <h3>Step 1: Baseline Query Performance (5 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">First, add test data to production.movies (at least 1000 rows):</p>
                <div class="sql-example" style="font-size: 0.75em;">
<span class="sql-comment">-- Generate test data using a loop</span><br>
<span class="sql-keyword">DO</span> $$<br>
<span class="sql-keyword">BEGIN</span><br>
&nbsp;&nbsp;<span class="sql-keyword">FOR</span> i <span class="sql-keyword">IN</span> 1..1000 <span class="sql-keyword">LOOP</span><br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">INSERT INTO</span> production.movies (title, director, genre)<br>
&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">VALUES</span> (<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Movie '</span> || i,<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Director '</span> || (i % 100),<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-string">'Genre '</span> || (i % 10)<br>
&nbsp;&nbsp;&nbsp;&nbsp;);<br>
&nbsp;&nbsp;<span class="sql-keyword">END LOOP</span>;<br>
<span class="sql-keyword">END</span> $$;
                </div>
                <p style="font-size: 1.0em; margin-top: 10px;">Run EXPLAIN ANALYZE on this query:</p>
                <div class="sql-example" style="font-size: 0.85em;">
<span class="sql-keyword">EXPLAIN ANALYZE</span><br>
<span class="sql-keyword">SELECT</span> * <span class="sql-keyword">FROM</span> production.movies <span class="sql-keyword">WHERE</span> director = <span class="sql-string">'Director 42'</span>;
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;"><strong>Screenshot:</strong> Capture the query plan showing "Seq Scan" (Sequential Scan)</p>
            </div>

            <div class="activity-box">
                <h3>Step 2: Create Architectural Optimization (10 pts)</h3>
                <div class="sql-example" style="font-size: 0.85em;">
<span class="sql-comment">-- Add index: architectural decision for performance</span><br>
<span class="sql-keyword">CREATE INDEX</span> idx_movies_director <span class="sql-keyword">ON</span> production.movies(director);
                </div>
                <p style="font-size: 1.0em; margin-top: 10px;">Run the same query again with EXPLAIN ANALYZE</p>
                <p style="font-size: 0.95em;"><strong>Screenshot:</strong> Capture showing "Index Scan" and compare execution time</p>
            </div>

            <div class="activity-box">
                <h3>Step 3: Document Architectural Impact (5 pts)</h3>
                <p style="font-size: 1.0em; margin-bottom: 10px;">Create a comparison table in your database:</p>
                <div class="sql-example" style="font-size: 0.8em;">
<span class="sql-keyword">CREATE TABLE</span> performance_analysis (<br>
&nbsp;&nbsp;test_name <span class="sql-keyword">VARCHAR</span>(100),<br>
&nbsp;&nbsp;execution_time_ms <span class="sql-keyword">NUMERIC</span>,<br>
&nbsp;&nbsp;scan_type <span class="sql-keyword">VARCHAR</span>(50),<br>
&nbsp;&nbsp;rows_scanned <span class="sql-keyword">INTEGER</span>,<br>
&nbsp;&nbsp;architectural_notes <span class="sql-keyword">TEXT</span><br>
);
                </div>
                <p style="font-size: 0.95em; margin-top: 10px;">Insert your findings comparing both query executions. Explain the architectural trade-off: indexes improve read performance but add storage overhead and slow down writes.</p>
            </div>

            <div class="tip-box">
                <strong>Key Learning:</strong> This demonstrates how the DBMS architecture makes query optimization decisions
            </div>
        </div>

        <!-- Slide 31: Submission Requirements -->
        <div class="slide">
            <h1>Submission Requirements <span class="emoji">📤</span></h1>

            <div class="warning-box">
                <h3>⚠️ Required Deliverables:</h3>
                <ol style="font-size: 1.05em; line-height: 1.8;">
                    <li><strong>SQL Script File:</strong> <code>LastName_FirstName_Week3_Architecture.sql</code>
                        <ul style="margin-top: 8px;">
                            <li>All CREATE SCHEMA statements</li>
                            <li>All CREATE TABLE statements (staging, production)</li>
                            <li>All CREATE VIEW statements (reporting)</li>
                            <li>All CREATE INDEX statements</li>
                            <li>Sample data population queries</li>
                            <li>EXPLAIN ANALYZE queries with comments</li>
                        </ul>
                    </li>
                    <li><strong>Screenshots Folder:</strong> <code>Week3_Screenshots/</code>
                        <ul style="margin-top: 8px;">
                            <li><code>1_movie_rental_erd_diagram.png</code> - ER diagram from DataGrip</li>
                            <li><code>2_multi_schema.png</code> - DataGrip sidebar showing all schemas</li>
                            <li><code>3_query_plan_before.png</code> - EXPLAIN ANALYZE without index</li>
                            <li><code>4_query_plan_after.png</code> - EXPLAIN ANALYZE with index</li>
                            <li><code>5_performance_results.png</code> - SELECT from performance_analysis table</li>
                        </ul>
                    </li>
                    <li><strong>README.md:</strong> Brief description of your architectural decisions
                        <ul style="margin-top: 8px;">
                            <li>Why you chose specific data types</li>
                            <li>How schemas represent different tiers</li>
                            <li>Performance improvements observed</li>
                        </ul>
                    </li>
                </ol>
            </div>

            <div class="demo-box">
                <h3>Submission Steps:</h3>
                <ol style="font-size: 1.1em; line-height: 1.8;">
                    <li>Create folder in your homework repository: <code>Week3_Architecture/</code></li>
                    <li>Add all SQL files, screenshots, and README</li>
                    <li>Commit with message: "Week 3: Database Architecture Implementation"</li>
                    <li>Submit commit URL to D2L</li>
                    <li><strong>Due:</strong> Before class next week</li>
                </ol>
            </div>

            <div class="demo-box">
                <h3>Grading Rubric (100 points):</h3>
                <table class="table-schema" style="font-size: 0.9em;">
                    <tr>
                        <th>Component</th>
                        <th>Points</th>
                        <th>Criteria</th>
                    </tr>
                    <tr>
                        <td><strong>Part 1: Discovery</strong></td>
                        <td>40</td>
                        <td>ER diagram quality (10), DDL completeness (15), Architecture analysis table (15)</td>
                    </tr>
                    <tr>
                        <td><strong>Part 2: Multi-Schema</strong></td>
                        <td>40</td>
                        <td>Schema creation (10), Tables with proper constraints (15), Views functionality (15)</td>
                    </tr>
                    <tr>
                        <td><strong>Part 3: Performance</strong></td>
                        <td>20</td>
                        <td>EXPLAIN ANALYZE screenshots (10), Performance documentation (10)</td>
                    </tr>
                </table>
            </div>

            <div class="tip-box">
                <strong>Pro Tip:</strong> Export your SQL from DataGrip using right-click → SQL Scripts → DDL for perfect formatting!
            </div>
        </div>

        <!-- Slide 32: Summary -->
        <div class="slide">
            <h1>Today's Takeaways <span class="emoji">🎓</span></h1>
            <h2>You Can Now:</h2>
            <ul style="font-size: 1.2em; line-height: 1.8;">
                <li>✅ Explain the ANSI-SPARC three-level architecture and data independence</li>
                <li>✅ Describe DBMS controlled access features (security, integrity, concurrency, recovery)</li>
                <li>✅ Analyze three-tier application architecture components and data flow</li>
                <li>✅ Compare centralized vs. distributed database architectures</li>
                <li>✅ Identify trade-offs in architectural decisions</li>
                <li>✅ Understand modern cloud and microservices database patterns</li>
                <li>✅ Design appropriate architectural views for different stakeholders</li>
            </ul>

            <div class="demo-box" style="margin-top: 30px;">
                <p><strong>Next Lecture:</strong> Entity-Relationship Modeling</p>
                <p><strong>Homework:</strong> Hands-on DataGrip architecture implementation - multi-schema design, ER diagrams, and query performance analysis (due next week)</p>
                <p><strong>Reading:</strong> Chapter 2 - Database System Concepts and Architecture</p>
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="navigation">
            <button id="prevBtn">Previous</button>
            <span class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">36</span>
            </span>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <!-- Shared Presentation JavaScript -->
    <script src="../../js/presentation.js"></script>

    <!-- Lecture-Specific JavaScript -->
    <script>
        // Database architecture specific interactions
        document.addEventListener('slidechange', (e) => {
            console.log(`Slide ${e.detail.currentSlide + 1} of ${e.detail.totalSlides}`);
            
            // Add any architecture-specific animations or interactions here
            const currentSlideElement = document.querySelectorAll('.slide')[e.detail.currentSlide];
            
            // Animate diagrams when they appear
            const diagrams = currentSlideElement.querySelectorAll('.erd-diagram pre');
            diagrams.forEach((diagram, index) => {
                setTimeout(() => {
                    diagram.style.opacity = '0';
                    diagram.style.transform = 'translateY(20px)';
                    diagram.style.transition = 'all 0.5s ease';
                    
                    setTimeout(() => {
                        diagram.style.opacity = '1';
                        diagram.style.transform = 'translateY(0)';
                    }, 100);
                }, index * 200);
            });
        });

        // Add keyboard navigation hints
        document.addEventListener('DOMContentLoaded', () => {
            console.log('Lecture 03: Database Architecture loaded');
            console.log('Use arrow keys or buttons to navigate');
            console.log('Press F for fullscreen mode');
        });
    </script>
</body>
</html>