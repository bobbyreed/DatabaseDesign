<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Advanced SQL - CSCI 5603</title>
    
    <!-- Database Design Presentation Styles with Theme Support -->
    <link rel="stylesheet" href="/styles/presentation.css">
    <link rel="icon" type="image/x-icon" href="/images/favicon.png">
    
    <!-- Import Courier Prime for analog feel -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Courier+Prime:wght@400;700&family=IBM+Plex+Mono:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    
    <!-- Lecture-Specific Styles -->
    <style>
        /* Override font for analog feel */
        body, .slide, h1, h2, h3, p, li {
            font-family: 'Courier Prime', 'IBM Plex Mono', 'Courier New', monospace !important;
        }
        
        /* SQL syntax highlighting classes now in presentation.css */

        .table-result {
            border-collapse: collapse;
            width: 100%;
            margin: 20px 0;
            font-family: 'IBM Plex Mono', monospace;
            font-size: 0.9em;
        }
        
        .table-result th {
            background: var(--ocu-true-blue);
            color: white;
            padding: 10px;
            text-align: left;
            font-weight: 600;
        }
        
        .table-result td {
            border: 1px solid var(--border-color);
            padding: 8px;
            background: var(--bg-secondary);
        }
        
        .table-result tr:nth-child(even) td {
            background: var(--bg-accent);
        }
        
        .concept-box {
            background: var(--bg-accent);
            border: 2px solid var(--ocu-cyan);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
        }
        
        .diagram-box {
            background: white;
            border: 2px solid var(--border-color);
            padding: 20px;
            border-radius: 10px;
            margin: 20px 0;
            text-align: center;
        }
        
        [data-theme="dark"] .diagram-box {
            background: var(--bg-secondary);
        }

        /* Bridge to Your Project boxes */
        .bridge-box {
            background-color: #f0f8ff;
            border-left: 4px solid #4a90e2;
            padding: 15px;
            margin: 20px 0;
            font-family: 'Courier Prime', monospace;
        }

        .bridge-box h4 {
            margin-top: 0;
            color: #4a90e2;
        }

        /* Netlify integration callouts */
        .netlify-callout {
            background-color: #e8f5e9;
            border-left: 4px solid #4caf50;
            padding: 15px;
            margin: 20px 0;
        }

        .netlify-callout h4 {
            margin-top: 0;
            color: #2e7d32;
        }

        /* Project example boxes */
        .project-example {
            background-color: #fff3e0;
            border: 1px solid #ff9800;
            padding: 10px;
            margin: 10px 0;
            border-radius: 4px;
        }

        .project-example strong {
            color: #e65100;
        }

        /* Dark mode overrides for all custom boxes */
        [data-theme='dark'] .bridge-box {
            background-color: #1a2a3a;
            border-left: 4px solid #009edb;
            color: #ffffff;
        }

        [data-theme='dark'] .bridge-box h4 {
            color: #009edb;
        }

        [data-theme='dark'] .netlify-callout {
            background-color: #1a2f1a;
            border-left: 4px solid #70bf54;
            color: #ffffff;
        }

        [data-theme='dark'] .netlify-callout h4 {
            color: #70bf54;
        }

        [data-theme='dark'] .project-example {
            background-color: #2a1f0f;
            border: 1px solid #ff9800;
            color: #ffffff;
        }

        [data-theme='dark'] .project-example strong {
            color: #ffc222;
        }
    </style>
</head>
<body>
    <!-- Theme toggle will be automatically added by JavaScript -->
    
    <div class="presentation-container">
        <!-- Timer display for activities -->
        <div class="timer-display" id="timer-display">
            <span id="timer-text">Advanced SQL
                 <button class="home"><a href="../../index.html">Home</a></button>
            </span>
        </div>

        <!-- Slide 1: Title -->
        <div class="slide active">
            <h1>Advanced SQL</h1>
            <h2>Subqueries, JOINs, and Set Operations <span class="emoji">üîß</span></h2>
            <p style="font-size: 1.5em; margin-top: 40px;">CSCI 5603 - Database Design</p>
            <p style="font-size: 1.3em;">Week 4, Lecture 8</p>
            <p style="margin-top: auto; font-style: italic;">Mastering complex database queries!</p>
            <p style="font-size: 0.9em; margin-top: 20px;">Instructor: Bobby Reed</p>
        </div>

        <!-- Slide 2: Learning Objectives -->
        <div class="slide">
            <h1>Today's Learning Objectives</h1>
            <ul style="font-size: 1.4em; line-height: 2;">
                <li>üéØ Master advanced JOIN operations (LEFT, RIGHT, FULL OUTER)</li>
                <li>üéØ Write and understand nested subqueries</li>
                <li>üéØ Use EXISTS, NOT EXISTS for powerful filtering</li>
                <li>üéØ Apply ANY, ALL, and SOME operators effectively</li>
                <li>üéØ Combine queries with set operations</li>
                <li>üéØ Build JOIN-based API endpoints for YOUR project</li>
                <li>üéØ Display related data beautifully in your frontend</li>
            </ul>
        </div>

        <!-- Slide 3: Historical Context -->
        <div class="slide">
            <h1>Historical Context <span class="emoji">üìú</span></h1>
            <h2>The Commercial Database Revolution</h2>

            <div class="concept-box">
                <h3>Early Commercial Successes (Early 1980s)</h3>
                <p style="font-size: 1.15em; line-height: 1.7;">The early 1980s witnessed the rise of commercial SQL databases that transformed the industry. Oracle (founded 1977, shipping Version 2 in 1979) was one of the first to commercialize SQL, followed by Sybase, Informix, and IBM DB2. These systems solidified SQL's dominance in the market and proved that relational databases could meet real-world business needs at scale.</p>
            </div>

            <div class="tip-box">
                <strong>Key Insight:</strong> The success of these early commercial databases demonstrated that Edgar Codd's theoretical relational model could be implemented efficiently and profitably‚Äîtransforming data management from an academic concept to a multi-billion dollar industry.
            </div>
        </div>

        <!-- Slide 4: Review - Basic JOINs -->
        <div class="slide">
            <h1>Quick Review: INNER JOIN</h1>
            <p>Before diving into advanced JOINs, let's review the basic INNER JOIN:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Show items with their category names (not just category_id)</span><br>
                <span class="sql-keyword">SELECT</span> i.item_id, i.name, c.category_name<br>
                <span class="sql-keyword">FROM</span> items i<br>
                <span class="sql-keyword">INNER JOIN</span> categories c <span class="sql-keyword">ON</span> i.category_id = c.category_id;
            </div>

            <div class="concept-box">
                <strong>Remember:</strong> INNER JOIN returns only matching rows from both tables.
                <br>If an item has no category assigned, or a category has no items, they won't appear!
            </div>

            <div class="bridge-box">
                <h4>üåâ Your Classmates' Examples</h4>
                <p><strong>See how your classmates use INNER JOIN:</strong></p>
                <ul>
                    <li><strong>Geethika (Hotel):</strong> <code>SELECT b.*, g.name, r.room_type FROM bookings b JOIN guests g ON b.guest_id = g.guest_id JOIN rooms r ON b.room_id = r.room_id;</code></li>
                    <li><strong>Suman (Retail):</strong> <code>SELECT p.product_name, c.category_name, s.supplier_name FROM products p JOIN categories c ON p.category_id = c.category_id JOIN suppliers s ON p.supplier_id = s.supplier_id;</code></li>
                    <li><strong>Doan (Bakery):</strong> <code>SELECT o.*, c.name, p.product_name FROM orders o JOIN customers c ON o.customer_id = c.customer_id JOIN products p ON o.product_id = p.product_id;</code></li>
                    <li><strong>Hanumantha (Club):</strong> <code>SELECT er.*, m.name, e.event_name FROM event_registrations er JOIN members m ON er.member_id = m.member_id JOIN events e ON er.event_id = e.event_id;</code></li>
                    <li><strong>Vineesh (Parking):</strong> <code>SELECT a.*, c.customer_name, e.full_name FROM availability a JOIN customers c ON a.customer_id = c.customer_id JOIN employees e ON a.employee_id = e.employee_id;</code></li>
                </ul>
            </div>
        </div>

        <!-- Slide 4: LEFT OUTER JOIN -->
        <div class="slide">
            <h1>LEFT OUTER JOIN</h1>
            <p>Includes ALL rows from the LEFT table, even without matches:</p>

            <div class="sql-example">
                <span class="sql-comment">-- List all categories and their items (including categories with no items)</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name, i.item_id, i.name<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">LEFT JOIN</span> items i<br>
                &nbsp;&nbsp;<span class="sql-keyword">ON</span> c.category_id = i.category_id;
            </div>

            <table class="table-result">
                <tr>
                    <th>category_id</th>
                    <th>category_name</th>
                    <th>item_id</th>
                    <th>name</th>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Electronics</td>
                    <td>101</td>
                    <td>Laptop</td>
                </tr>
                <tr>
                    <td>2</td>
                    <td>Books</td>
                    <td>NULL</td>
                    <td>NULL</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Tools</td>
                    <td>103</td>
                    <td>Hammer</td>
                </tr>
            </table>

            <div class="tip-box">
                <strong>Key Point:</strong> NULL values appear for the right table when no match exists.
            </div>

            <div class="bridge-box">
                <h4>üåâ Your Classmates' Examples</h4>
                <p><strong>When to use LEFT JOIN in YOUR project:</strong></p>
                <ul>
                    <li><strong>Geethika (Hotel):</strong> <code>SELECT g.*, COUNT(b.booking_id) FROM guests g LEFT JOIN bookings b ON g.guest_id = b.guest_id GROUP BY g.guest_id;</code> (show all guests, even those with no bookings)</li>
                    <li><strong>Suman (Retail):</strong> <code>SELECT c.*, COUNT(p.product_id) FROM categories c LEFT JOIN products p ON c.category_id = p.category_id GROUP BY c.category_id;</code> (all categories, even empty ones)</li>
                    <li><strong>Doan (Bakery):</strong> <code>SELECT c.*, COUNT(o.order_id) FROM customers c LEFT JOIN orders o ON c.customer_id = o.customer_id GROUP BY c.customer_id;</code> (all customers, even those who haven't ordered)</li>
                    <li><strong>Hanumantha (Club):</strong> <code>SELECT m.*, COUNT(er.registration_id) FROM members m LEFT JOIN event_registrations er ON m.member_id = er.member_id GROUP BY m.member_id;</code> (all members, even inactive)</li>
                    <li><strong>Vineesh (Parking):</strong> <code>SELECT e.*, COUNT(a.slot_id) FROM employees e LEFT JOIN availability a ON e.employee_id = a.employee_id GROUP BY e.employee_id;</code> (all employees, even those not assigned)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 5: RIGHT OUTER JOIN -->
        <div class="slide">
            <h1>RIGHT OUTER JOIN</h1>
            <p>Includes ALL rows from the RIGHT table, even without matches:</p>

            <div class="sql-example">
                <span class="sql-comment">-- List all items and their categories (including uncategorized items)</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name, i.item_id, i.name<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">RIGHT JOIN</span> items i<br>
                &nbsp;&nbsp;<span class="sql-keyword">ON</span> c.category_id = i.category_id;
            </div>

            <table class="table-result">
                <tr>
                    <th>category_id</th>
                    <th>category_name</th>
                    <th>item_id</th>
                    <th>name</th>
                </tr>
                <tr>
                    <td>NULL</td>
                    <td>NULL</td>
                    <td>99</td>
                    <td>Misc Item</td>
                </tr>
                <tr>
                    <td>1</td>
                    <td>Electronics</td>
                    <td>101</td>
                    <td>Laptop</td>
                </tr>
                <tr>
                    <td>3</td>
                    <td>Tools</td>
                    <td>103</td>
                    <td>Hammer</td>
                </tr>
            </table>

            <div class="demo-box">
                <strong>Pro Tip:</strong> RIGHT JOIN can always be rewritten as LEFT JOIN by swapping table order!
            </div>
        </div>

        <!-- Slide 6: FULL OUTER JOIN -->
        <div class="slide">
            <h1>FULL OUTER JOIN</h1>
            <p>Combines LEFT and RIGHT JOINs - includes ALL rows from BOTH tables:</p>

            <div class="sql-example">
                <span class="sql-comment">-- List all categories and items, showing unmatched from both</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;i.item_id, i.name<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">FULL OUTER JOIN</span> items i<br>
                &nbsp;&nbsp;<span class="sql-keyword">ON</span> c.category_id = i.category_id;
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Note:</strong> Not all databases support FULL OUTER JOIN (MySQL doesn't).
                You can simulate it using UNION of LEFT and RIGHT JOINs.
            </div>

            <div class="bridge-box">
                <h4>üåâ Your Classmates' Examples</h4>
                <p><strong>FULL JOIN use cases - find mismatched data:</strong></p>
                <ul>
                    <li><strong>Geethika (Hotel):</strong> Find rooms with no bookings AND bookings with invalid room IDs (data quality check)</li>
                    <li><strong>Suman (Retail):</strong> Identify products without categories AND categories with no products (audit report)</li>
                    <li><strong>Doan (Bakery):</strong> Find customers who never ordered AND orders with invalid customer IDs</li>
                    <li><strong>Hanumantha (Club):</strong> Show members with no event registrations AND registrations with invalid member IDs</li>
                    <li><strong>Vineesh (Parking):</strong> Find employees never assigned slots AND slots with invalid employee IDs</li>
                </ul>
            </div>
        </div>

        <!-- Slide 7: Introduction to Subqueries -->
        <div class="slide">
            <h1>Introduction to Subqueries</h1>
            <p>A query within a query - incredibly powerful for complex logic!</p>

            <div class="concept-box">
                <h3>Types of Subqueries:</h3>
                <ul>
                    <li><strong>Scalar:</strong> Returns a single value</li>
                    <li><strong>Row:</strong> Returns a single row</li>
                    <li><strong>Table:</strong> Returns multiple rows and columns</li>
                    <li><strong>Correlated:</strong> References outer query columns</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Simple scalar subquery: Find items in a specific supplier's category</span><br>
                <span class="sql-keyword">SELECT</span> item_id, name, price<br>
                <span class="sql-keyword">FROM</span> items<br>
                <span class="sql-keyword">WHERE</span> category_id = (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> category_id<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> categories<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> category_name = <span class="sql-string">'Electronics'</span><br>
                );
            </div>

            <div class="bridge-box">
                <h4>üåâ Your Classmates' Examples</h4>
                <p><strong>Subquery use cases:</strong></p>
                <ul>
                    <li><strong>Geethika (Hotel):</strong> <code>SELECT * FROM rooms WHERE room_type = (SELECT room_type FROM rooms GROUP BY room_type ORDER BY COUNT(*) DESC LIMIT 1);</code> (most common room type)</li>
                    <li><strong>Suman (Retail):</strong> <code>SELECT * FROM products WHERE category_id = (SELECT category_id FROM products GROUP BY category_id ORDER BY SUM(quantity_in_stock * price) DESC LIMIT 1);</code> (highest-value category)</li>
                    <li><strong>Doan (Bakery):</strong> <code>SELECT * FROM products WHERE category = (SELECT category FROM orders o JOIN products p ON o.product_id = p.product_id GROUP BY category ORDER BY SUM(quantity) DESC LIMIT 1);</code> (best-selling category)</li>
                    <li><strong>Hanumantha (Club):</strong> <code>SELECT * FROM events WHERE event_id IN (SELECT event_id FROM event_registrations GROUP BY event_id HAVING COUNT(*) > 10);</code> (popular events)</li>
                    <li><strong>Vineesh (Parking):</strong> <code>SELECT * FROM customers WHERE customer_id IN (SELECT customer_id FROM availability GROUP BY customer_id HAVING COUNT(*) > 5);</code> (frequent parkers)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 8: Subquery with Aggregate -->
        <div class="slide">
            <h1>Subqueries with Aggregates</h1>
            <p>Perfect for comparisons against calculated values:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Find products priced higher than average</span><br>
                <span class="sql-keyword">SELECT</span> product_id, name, price,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;price - (<span class="sql-keyword">SELECT</span> <span class="sql-function">AVG</span>(price) <span class="sql-keyword">FROM</span> products) <span class="sql-keyword">AS</span> above_avg<br>
                <span class="sql-keyword">FROM</span> products<br>
                <span class="sql-keyword">WHERE</span> price > (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> <span class="sql-function">AVG</span>(price)<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> products<br>
                );
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Common Mistake:</strong> You CANNOT write: WHERE price > AVG(price)
                <br>Aggregate functions need GROUP BY or subqueries!
            </div>

            <div class="bridge-box">
                <h4>üåâ Your Classmates' Examples</h4>
                <p><strong>Aggregate subquery examples:</strong></p>
                <ul>
                    <li><strong>Geethika (Hotel):</strong> <code>SELECT * FROM rooms WHERE price_per_night > (SELECT AVG(price_per_night) FROM rooms);</code> (above-average priced rooms)</li>
                    <li><strong>Suman (Retail):</strong> <code>SELECT * FROM products WHERE price > (SELECT AVG(price) FROM products WHERE category_id = products.category_id);</code> (above-average for category - correlated)</li>
                    <li><strong>Doan (Bakery):</strong> <code>SELECT * FROM orders WHERE total_price > (SELECT AVG(total_price) FROM orders);</code> (high-value orders)</li>
                    <li><strong>Hanumantha (Club):</strong> <code>SELECT * FROM members WHERE (SELECT COUNT(*) FROM event_registrations WHERE member_id = members.member_id) > (SELECT AVG(reg_count) FROM (SELECT COUNT(*) as reg_count FROM event_registrations GROUP BY member_id) AS avg_regs);</code> (active members)</li>
                    <li><strong>Vineesh (Parking):</strong> <code>SELECT * FROM availability WHERE EXTRACT(EPOCH FROM (exit_time - entry_time))/3600 > (SELECT AVG(EXTRACT(EPOCH FROM (exit_time - entry_time))/3600) FROM availability WHERE exit_time IS NOT NULL);</code> (longer than average parking duration)</li>
                </ul>
            </div>
        </div>

        <!-- Slide 9: IN Operator with Subqueries -->
        <div class="slide">
            <h1>Using IN with Subqueries</h1>
            <p>Check if a value exists in a subquery result set:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Nested subquery: Find items supplied by premium suppliers</span><br>
                <span class="sql-keyword">SELECT</span> item_id, name, price<br>
                <span class="sql-keyword">FROM</span> items<br>
                <span class="sql-keyword">WHERE</span> supplier_id <span class="sql-keyword">IN</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> supplier_id<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> suppliers<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> rating = <span class="sql-string">'Premium'</span><br>
                );
            </div>

            <div class="tip-box">
                <strong>Performance Tip:</strong> IN is great for small result sets.
                For large sets, consider EXISTS instead.
            </div>

            <div class="bridge-box">
                <h4>üåâ Bridge to Your Project</h4>
                <p><strong>IN subquery patterns:</strong></p>
                <ul>
                    <li><strong>Recipe database:</strong> Find recipes using ingredients from local suppliers</li>
                    <li><strong>Movie rental:</strong> List movies rented by VIP members</li>
                    <li><strong>Event planner:</strong> Show events at venues in premium locations</li>
                </ul>
            </div>
        </div>

        <!-- Slide 10: JOINs Power Your Netlify API -->
        <div class="slide">
            <h1>JOINs Power Your Netlify API</h1>
            <h2>Rich API Responses with Related Data</h2>

            <div class="netlify-callout">
                <h4>üöÄ Why JOINs Matter for Your API</h4>
                <p>Without JOINs, your API returns IDs. With JOINs, it returns meaningful data!</p>
            </div>

            <div class="comparison-table">
                <div class="comparison-card bad">
                    <h3>‚ùå Without JOIN</h3>
                    <div class="sql-example" style="font-size: 0.8em;">
                        {<br>
                        &nbsp;&nbsp;"item_id": 101,<br>
                        &nbsp;&nbsp;"name": "Laptop",<br>
                        &nbsp;&nbsp;"category_id": 1<br>
                        }
                    </div>
                    <p>Frontend has to make another API call to get category name!</p>
                </div>
                <div class="comparison-card good">
                    <h3>‚úÖ With JOIN</h3>
                    <div class="sql-example" style="font-size: 0.8em;">
                        {<br>
                        &nbsp;&nbsp;"item_id": 101,<br>
                        &nbsp;&nbsp;"name": "Laptop",<br>
                        &nbsp;&nbsp;"category_name": "Electronics"<br>
                        }
                    </div>
                    <p>Everything the frontend needs in one request!</p>
                </div>
            </div>
        </div>

        <!-- Slide 11: Implementing JOIN-Based Endpoints -->
        <div class="slide">
            <h1>Implementing JOIN-Based Endpoints</h1>
            <h2>Netlify Function with JOINs</h2>

            <div class="sql-example" style="font-size: 0.75em;">
                <span class="sql-comment">// netlify/functions/items-with-categories.js</span><br>
                <span class="sql-keyword">const</span> { Pool } = require(<span class="sql-string">'pg'</span>);<br>
                <span class="sql-keyword">const</span> pool = <span class="sql-keyword">new</span> Pool({ connectionString: process.env.DATABASE_URL });<br><br>

                exports.handler = <span class="sql-keyword">async</span> (event, context) => {<br>
                &nbsp;&nbsp;<span class="sql-keyword">const</span> query = <span class="sql-string">`<br>
                &nbsp;&nbsp;&nbsp;&nbsp;SELECT i.item_id, i.name, i.price, i.description,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;c.category_name, c.description as category_desc<br>
                &nbsp;&nbsp;&nbsp;&nbsp;FROM items i<br>
                &nbsp;&nbsp;&nbsp;&nbsp;LEFT JOIN categories c ON i.category_id = c.category_id<br>
                &nbsp;&nbsp;&nbsp;&nbsp;ORDER BY i.name<br>
                &nbsp;&nbsp;`</span>;<br><br>

                &nbsp;&nbsp;<span class="sql-keyword">try</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">const</span> result = <span class="sql-keyword">await</span> pool.query(query);<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">return</span> {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;statusCode: <span class="sql-number">200</span>,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;body: JSON.stringify(result.rows)<br>
                &nbsp;&nbsp;&nbsp;&nbsp;};<br>
                &nbsp;&nbsp;} <span class="sql-keyword">catch</span> (error) {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">return</span> { statusCode: <span class="sql-number">500</span>, body: JSON.stringify({ error: error.message }) };<br>
                &nbsp;&nbsp;}<br>
                };
            </div>
        </div>

        <!-- Slide 12: Nested vs Flat JSON -->
        <div class="slide">
            <h1>Nested vs Flat JSON Structures</h1>
            <h2>Two Approaches for JOIN Results</h2>

            <div class="comparison-table">
                <div class="comparison-card">
                    <h3>Flat Structure (Easier)</h3>
                    <div class="sql-example" style="font-size: 0.75em;">
                        {<br>
                        &nbsp;&nbsp;"item_id": 101,<br>
                        &nbsp;&nbsp;"name": "Laptop",<br>
                        &nbsp;&nbsp;"price": 999.99,<br>
                        &nbsp;&nbsp;"category_id": 1,<br>
                        &nbsp;&nbsp;"category_name": "Electronics",<br>
                        &nbsp;&nbsp;"category_desc": "Electronic devices"<br>
                        }
                    </div>
                    <p><strong>Pros:</strong> Simple query, easy frontend</p>
                </div>
                <div class="comparison-card">
                    <h3>Nested Structure (Cleaner)</h3>
                    <div class="sql-example" style="font-size: 0.75em;">
                        {<br>
                        &nbsp;&nbsp;"item_id": 101,<br>
                        &nbsp;&nbsp;"name": "Laptop",<br>
                        &nbsp;&nbsp;"price": 999.99,<br>
                        &nbsp;&nbsp;"category": {<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"category_id": 1,<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"name": "Electronics",<br>
                        &nbsp;&nbsp;&nbsp;&nbsp;"description": "Electronic devices"<br>
                        &nbsp;&nbsp;}<br>
                        }
                    </div>
                    <p><strong>Pros:</strong> Better organization, clearer relationships</p>
                </div>
            </div>

            <div class="tip-box">
                <strong>Start with flat!</strong> It's simpler. Try nested for bonus points!
            </div>
        </div>

        <!-- Slide 13: Frontend Display of JOIN Data -->
        <div class="slide">
            <h1>Frontend Display of JOIN Data</h1>

            <div class="sql-example" style="font-size: 0.8em;">
                <span class="sql-comment">// Fetch and display items with categories</span><br>
                <span class="sql-keyword">async function</span> loadItems() {<br>
                &nbsp;&nbsp;<span class="sql-keyword">const</span> response = <span class="sql-keyword">await</span> fetch(<span class="sql-string">'/.netlify/functions/items-with-categories'</span>);<br>
                &nbsp;&nbsp;<span class="sql-keyword">const</span> items = <span class="sql-keyword">await</span> response.json();<br><br>

                &nbsp;&nbsp;<span class="sql-keyword">const</span> container = document.getElementById(<span class="sql-string">'items-list'</span>);<br>
                &nbsp;&nbsp;items.forEach(item => {<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-keyword">const</span> card = <span class="sql-string">`<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;div class="item-card"&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;h3&gt;${item.name}&lt;/h3&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;p class="price"&gt;$${item.price}&lt;/p&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;span class="category-badge"&gt;${item.category_name}&lt;/span&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/div&gt;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;`</span>;<br>
                &nbsp;&nbsp;&nbsp;&nbsp;container.innerHTML += card;<br>
                &nbsp;&nbsp;});<br>
                }
            </div>

            <div class="project-example">
                <strong>Result:</strong> Each item displays with its category name as a badge, not just "category_id: 1"
            </div>
        </div>

        <!-- Slide 14: Styling Related Data -->
        <div class="slide">
            <h1>Styling Related Data</h1>

            <div class="sql-example" style="font-size: 0.85em;">
                <span class="sql-comment">/* CSS for category badges */</span><br>
                .category-badge {<br>
                &nbsp;&nbsp;background-color: #4a90e2;<br>
                &nbsp;&nbsp;color: white;<br>
                &nbsp;&nbsp;padding: 4px 12px;<br>
                &nbsp;&nbsp;border-radius: 12px;<br>
                &nbsp;&nbsp;font-size: 0.85em;<br>
                &nbsp;&nbsp;font-weight: 600;<br>
                &nbsp;&nbsp;display: inline-block;<br>
                &nbsp;&nbsp;margin-top: 8px;<br>
                }<br><br>

                .item-card {<br>
                &nbsp;&nbsp;border: 1px solid #ddd;<br>
                &nbsp;&nbsp;padding: 16px;<br>
                &nbsp;&nbsp;margin: 12px 0;<br>
                &nbsp;&nbsp;border-radius: 8px;<br>
                &nbsp;&nbsp;box-shadow: 0 2px 4px rgba(0,0,0,0.1);<br>
                }
            </div>

            <div class="demo-box">
                <h3>Visual Example:</h3>
                <div style="border: 1px solid #ddd; padding: 16px; margin: 12px 0; border-radius: 8px;">
                    <h3 style="margin: 0 0 8px 0;">Laptop</h3>
                    <p style="margin: 0 0 8px 0; font-weight: 600;">$999.99</p>
                    <span style="background-color: #4a90e2; color: white; padding: 4px 12px; border-radius: 12px; font-size: 0.85em;">Electronics</span>
                </div>
            </div>
        </div>

        <!-- Slide 15: Build Your First JOIN API -->
        <div class="slide">
            <h1>Exercise: Build Your First JOIN API</h1>
            <h2>15-Minute Challenge</h2>

            <div class="activity-box">
                <h3>Your Task:</h3>
                <ol style="font-size: 1.1em; line-height: 1.8;">
                    <li>Create a new Netlify function that joins 2 of YOUR tables</li>
                    <li>Use LEFT JOIN to include all records from the main table</li>
                    <li>Return the data as flat JSON structure</li>
                    <li>Test the endpoint in your browser</li>
                </ol>
            </div>

            <div class="tip-box">
                <h3>Example endpoints you could create:</h3>
                <ul>
                    <li><strong>recipes-with-categories.js</strong> - Recipes showing category names</li>
                    <li><strong>movies-with-studios.js</strong> - Movies showing studio names</li>
                    <li><strong>events-with-venues.js</strong> - Events showing venue details</li>
                    <li><strong>products-with-suppliers.js</strong> - Products showing supplier names</li>
                </ul>
            </div>

            <button data-timer="15">Start 15-Minute Timer</button>
        </div>

        <!-- Slide 16: Activity 1 - JOIN Practice -->
        <div class="slide">
            <h1>Activity 1: JOIN Challenge <span class="emoji">üíª</span></h1>
            <div class="activity-box">
                <h3>15-Minute Exercise</h3>
                <p>Using YOUR project database, write queries to:</p>
                <ol>
                    <li>Join 2 of your tables using INNER JOIN</li>
                    <li>Join the same tables using LEFT JOIN - observe the difference</li>
                    <li>Find records in one table that have NO matches in the related table</li>
                    <li>Create a query that shows "orphaned" records (items without categories, etc.)</li>
                </ol>
                <p style="margin-top: 20px;"><strong>Hint:</strong> Think about which JOIN type preserves unmatched rows!</p>
            </div>
            <button data-timer="15">Start 15-Minute Timer</button>
        </div>

        <!-- Slide 17: ANY and ALL Operators -->
        <div class="slide">
            <h1>ANY and ALL Operators</h1>
            <p>Compare a value against a set of values from a subquery:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Find products priced higher than ANY product in "Electronics"</span><br>
                <span class="sql-keyword">SELECT</span> product_id, name, price<br>
                <span class="sql-keyword">FROM</span> products<br>
                <span class="sql-keyword">WHERE</span> price > <span class="sql-keyword">ANY</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> price<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> products<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> category_id = (<span class="sql-keyword">SELECT</span> category_id <span class="sql-keyword">FROM</span> categories <span class="sql-keyword">WHERE</span> category_name = <span class="sql-string">'Electronics'</span>)<br>
                );
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Find products priced higher than ALL products in "Electronics"</span><br>
                <span class="sql-keyword">SELECT</span> product_id, name, price<br>
                <span class="sql-keyword">FROM</span> products<br>
                <span class="sql-keyword">WHERE</span> price > <span class="sql-keyword">ALL</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> price<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> products<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> category_id = (<span class="sql-keyword">SELECT</span> category_id <span class="sql-keyword">FROM</span> categories <span class="sql-keyword">WHERE</span> category_name = <span class="sql-string">'Electronics'</span>)<br>
                );
            </div>

            <div class="concept-box">
                <strong>Remember:</strong>
                <ul>
                    <li>ANY: At least one value satisfies the condition</li>
                    <li>ALL: Every value must satisfy the condition</li>
                    <li>SOME: Synonym for ANY</li>
                    <li>Empty subquery: ALL returns TRUE, ANY returns FALSE</li>
                </ul>
            </div>
        </div>

        <!-- Slide 18: EXISTS and NOT EXISTS -->
        <div class="slide">
            <h1>EXISTS and NOT EXISTS</h1>
            <p>Check for the existence of rows - returns TRUE/FALSE only:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Find categories that have at least one item</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">WHERE</span> <span class="sql-keyword">EXISTS</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> *<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> items i<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> i.category_id = c.category_id<br>
                );
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Find categories with NO items (empty categories)</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">WHERE</span> <span class="sql-keyword">NOT EXISTS</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> *<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> items i<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> i.category_id = c.category_id<br>
                );
            </div>

            <div class="tip-box">
                <strong>Performance:</strong> EXISTS often faster than IN for large datasets -
                it stops searching once it finds the first match!
            </div>

            <div class="bridge-box">
                <h4>üåâ Bridge to Your Project</h4>
                <p><strong>EXISTS use cases:</strong></p>
                <ul>
                    <li><strong>Data quality:</strong> Find empty categories, unused venues, inactive suppliers</li>
                    <li><strong>Recipe database:</strong> Show categories with NO recipes (need content!)</li>
                    <li><strong>Movie rental:</strong> Find members who HAVE rented vs. never rented</li>
                    <li><strong>Inventory:</strong> Identify suppliers with NO current products</li>
                </ul>
            </div>
        </div>

        <!-- Slide 19: Correlated Subqueries -->
        <div class="slide">
            <h1>Correlated Subqueries</h1>
            <p>Subqueries that reference the outer query - executed for each row:</p>

            <div class="sql-example">
                <span class="sql-comment">-- Find products priced higher than average for their category</span><br>
                <span class="sql-keyword">SELECT</span> p1.product_id, p1.name, p1.price, p1.category_id<br>
                <span class="sql-keyword">FROM</span> products p1<br>
                <span class="sql-keyword">WHERE</span> p1.price > (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> <span class="sql-function">AVG</span>(p2.price)<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> products p2<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> p2.category_id = p1.category_id  <span class="sql-comment">-- References outer query!</span><br>
                );
            </div>

            <div class="warning-box">
                <strong>‚ö†Ô∏è Performance Warning:</strong> Correlated subqueries run once per row
                in the outer query. Can be slow on large tables!
            </div>

            <div class="bridge-box">
                <h4>üåâ Bridge to Your Project</h4>
                <p><strong>Correlated subquery patterns:</strong></p>
                <ul>
                    <li><strong>Recipe database:</strong> Recipes with prep time > average for their difficulty level</li>
                    <li><strong>Movie rental:</strong> Movies with rental count > average for their genre</li>
                    <li><strong>E-commerce:</strong> Products with sales > average for their supplier</li>
                </ul>
            </div>
        </div>

        <!-- Slide 20: Set Operations Overview -->
        <div class="slide">
            <h1>Set Operations</h1>
            <p>Combine results from multiple queries:</p>

            <div class="concept-box">
                <h3>SQL Set Operations:</h3>
                <ul>
                    <li><strong>UNION:</strong> All rows from both queries (removes duplicates)</li>
                    <li><strong>UNION ALL:</strong> All rows including duplicates</li>
                    <li><strong>INTERSECT:</strong> Only rows in both queries</li>
                    <li><strong>EXCEPT/MINUS:</strong> Rows in first but not second query</li>
                </ul>
            </div>

            <div class="sql-example">
                <span class="sql-comment">-- Find tags used in both products AND categories</span><br>
                <span class="sql-keyword">SELECT</span> tag_name <span class="sql-keyword">FROM</span> product_tags<br>
                <span class="sql-keyword">INTERSECT</span><br>
                <span class="sql-keyword">SELECT</span> tag_name <span class="sql-keyword">FROM</span> category_tags;
            </div>

            <div class="tip-box">
                <strong>Requirement:</strong> Queries must be union-compatible
                (same number of columns, compatible data types)
            </div>

            <div class="bridge-box">
                <h4>üåâ Bridge to Your Project</h4>
                <p><strong>Set operation examples:</strong></p>
                <ul>
                    <li><strong>UNION:</strong> Combine active + archived items into one list</li>
                    <li><strong>INTERSECT:</strong> Find ingredients used in both breakfast AND lunch recipes</li>
                    <li><strong>EXCEPT:</strong> Show members who registered but never made a rental</li>
                </ul>
            </div>
        </div>

        <!-- Slide 21: Complex Query Example -->
        <div class="slide">
            <h1>Putting It All Together</h1>
            <p>A complex real-world query combining multiple concepts:</p>

            <div class="sql-example" style="font-size: 0.85em;">
                <span class="sql-comment">-- Find top-performing categories: >3 items AND avg price above overall average</span><br>
                <span class="sql-keyword">SELECT</span> c.category_id, c.category_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">COUNT</span>(i.item_id) <span class="sql-keyword">AS</span> item_count,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">AVG</span>(i.price) <span class="sql-keyword">AS</span> avg_price<br>
                <span class="sql-keyword">FROM</span> categories c<br>
                <span class="sql-keyword">LEFT JOIN</span> items i <span class="sql-keyword">ON</span> c.category_id = i.category_id<br>
                <span class="sql-keyword">WHERE</span> <span class="sql-keyword">EXISTS</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> <span class="sql-number">1</span> <span class="sql-keyword">FROM</span> items i2<br>
                &nbsp;&nbsp;<span class="sql-keyword">WHERE</span> i2.category_id = c.category_id<br>
                )<br>
                <span class="sql-keyword">GROUP BY</span> c.category_id, c.category_name<br>
                <span class="sql-keyword">HAVING</span> <span class="sql-function">COUNT</span>(i.item_id) > <span class="sql-number">3</span><br>
                &nbsp;&nbsp;<span class="sql-keyword">AND</span> <span class="sql-function">AVG</span>(i.price) > (<span class="sql-keyword">SELECT</span> <span class="sql-function">AVG</span>(price) <span class="sql-keyword">FROM</span> items)<br>
                <span class="sql-keyword">ORDER BY</span> item_count <span class="sql-keyword">DESC</span>, avg_price <span class="sql-keyword">DESC</span>;
            </div>

            <div class="demo-box">
                <h3>Query Breakdown:</h3>
                <ul>
                    <li>‚úÖ LEFT JOIN to preserve all categories</li>
                    <li>‚úÖ EXISTS to filter only categories with items</li>
                    <li>‚úÖ Subquery to compare against overall average</li>
                    <li>‚úÖ GROUP BY with HAVING for aggregate filtering</li>
                </ul>
            </div>
        </div>

        <!-- Slide 22: Activity 2 - Subquery Challenge -->
        <div class="slide">
            <h1>Activity 2: Subquery Master <span class="emoji">üß©</span></h1>
            <div class="activity-box">
                <h3>20-Minute Challenge</h3>
                <p>Write queries for YOUR project using subqueries to find:</p>
                <ol>
                    <li>Items/products priced higher than the overall average</li>
                    <li>Records in one table that exceed ALL values in a specific category</li>
                    <li>Categories/groups where EVERY item meets a condition (e.g., price > $50)</li>
                    <li>Find orphaned records (items without categories, events without venues, etc.)</li>
                    <li>The category/supplier/studio with the highest aggregate value</li>
                </ol>
                <p style="margin-top: 20px;"><strong>Bonus:</strong> Rewrite query #4 using both EXISTS and NOT IN approaches!</p>
            </div>
            <button data-timer="20">Start 20-Minute Timer</button>
        </div>

        <!-- Slide 17: Query Optimization Tips -->
        <div class="slide">
            <h1>Query Optimization Best Practices</h1>
            
            <div class="comparison-table">
                <div class="comparison-card good">
                    <h3>‚úÖ DO</h3>
                    <ul>
                        <li>Use EXISTS for existence checks</li>
                        <li>Index foreign key columns</li>
                        <li>Filter early with WHERE</li>
                        <li>Use appropriate JOIN types</li>
                        <li>Consider query execution order</li>
                    </ul>
                </div>
                <div class="comparison-card bad">
                    <h3>‚ùå AVOID</h3>
                    <ul>
                        <li>SELECT * in production</li>
                        <li>Unnecessary nested subqueries</li>
                        <li>Correlated subqueries on large tables</li>
                        <li>DISTINCT when not needed</li>
                        <li>Functions in WHERE clauses</li>
                    </ul>
                </div>
            </div>
            
            <div class="demo-box">
                <strong>Pro Tip:</strong> Use EXPLAIN PLAN to understand how your database executes queries!
            </div>
        </div>

        <!-- Slide 18: Common Pitfalls -->
        <div class="slide">
            <h1>Common Mistakes to Avoid</h1>
            
            <div class="warning-box">
                <h3>üö´ Pitfall #1: NULL Handling</h3>
                <p>NULLs in subqueries can cause unexpected results:</p>
                <code>WHERE column NOT IN (subquery)</code>
                <p>Returns NO rows if subquery contains NULL!</p>
            </div>
            
            <div class="warning-box">
                <h3>üö´ Pitfall #2: Subquery Returns Multiple Rows</h3>
                <p>Using = with a multi-row subquery causes an error.</p>
                <p>Solution: Use IN, ANY, or ALL instead.</p>
            </div>
            
            <div class="warning-box">
                <h3>üö´ Pitfall #3: Forgetting Table Aliases</h3>
                <p>In correlated subqueries, always use clear aliases to avoid ambiguity.</p>
            </div>
        </div>

        <!-- Slide 25: Real-World Application -->
        <div class="slide">
            <h1>Real-World Scenario</h1>
            <p>Let's solve a business problem using advanced SQL:</p>

            <div class="demo-box">
                <h3>Business Requirement:</h3>
                <p>"Find underperforming categories: those with below-average item count
                   and average price below $25"</p>
            </div>

            <div class="sql-example" style="font-size: 0.8em;">
                <span class="sql-keyword">WITH</span> CategoryStats <span class="sql-keyword">AS</span> (<br>
                &nbsp;&nbsp;<span class="sql-keyword">SELECT</span> c.category_id, c.category_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">COUNT</span>(i.item_id) <span class="sql-keyword">AS</span> item_count,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">AVG</span>(i.price) <span class="sql-keyword">AS</span> avg_price<br>
                &nbsp;&nbsp;<span class="sql-keyword">FROM</span> categories c<br>
                &nbsp;&nbsp;<span class="sql-keyword">LEFT JOIN</span> items i <span class="sql-keyword">ON</span> c.category_id = i.category_id<br>
                &nbsp;&nbsp;<span class="sql-keyword">GROUP BY</span> c.category_id, c.category_name<br>
                )<br>
                <span class="sql-keyword">SELECT</span> * <span class="sql-keyword">FROM</span> CategoryStats<br>
                <span class="sql-keyword">WHERE</span> item_count < (<span class="sql-keyword">SELECT</span> <span class="sql-function">AVG</span>(item_count) <span class="sql-keyword">FROM</span> CategoryStats)<br>
                &nbsp;&nbsp;<span class="sql-keyword">AND</span> (avg_price < <span class="sql-number">25</span> <span class="sql-keyword">OR</span> avg_price <span class="sql-keyword">IS NULL</span>);
            </div>

            <div class="bridge-box">
                <h4>üåâ Bridge to Your Project</h4>
                <p><strong>Adapt for YOUR data:</strong></p>
                <ul>
                    <li><strong>Recipe database:</strong> Categories with few recipes AND low avg rating</li>
                    <li><strong>Movie rental:</strong> Studios with few movies AND low rental frequency</li>
                    <li><strong>Event planner:</strong> Venues with few bookings AND low revenue</li>
                </ul>
            </div>
        </div>

        <!-- Slide 26: Activity 3 - Integration Challenge -->
        <div class="slide">
            <h1>Activity 3: Integration Challenge <span class="emoji">üöÄ</span></h1>
            <div class="activity-box">
                <h3>25-Minute Complex Query Exercise</h3>
                <p><strong>Scenario:</strong> Create a comprehensive analytics report for YOUR project!</p>
                <p>Create a query that shows:</p>
                <ul>
                    <li>All categories/groups with their details</li>
                    <li>Count of related items in each category</li>
                    <li>Average price/value/rating for each category</li>
                    <li>Classification based on performance metrics</li>
                    <li>Comparison to overall averages</li>
                </ul>
                <p style="margin-top: 20px;"><strong>Requirements:</strong></p>
                <ul>
                    <li>Use at least one OUTER JOIN</li>
                    <li>Include a subquery (correlated or scalar)</li>
                    <li>Use CASE statement for classification (e.g., "High", "Medium", "Low")</li>
                    <li>Include GROUP BY with HAVING</li>
                </ul>
            </div>
            <button data-timer="25">Start 25-Minute Timer</button>
        </div>

        <!-- IN-CLASS EXERCISES -->

        <!-- Slide 21: Exercise Overview -->
        <div class="slide">
            <h1>In-Class Exercises <span class="emoji">üèóÔ∏è</span></h1>
            <h2>Multi-JOIN & Aggregation Practice</h2>

            <div class="demo-box">
                <h3>Exercise Overview</h3>
                <p style="font-size: 1.2em;">Today, you'll practice writing complex SQL queries involving three-table JOINs and advanced aggregation with GROUP BY and HAVING clauses.</p>
            </div>

            <div class="activity-box">
                <h3>Learning Objectives</h3>
                <ul style="font-size: 1.15em;">
                    <li>‚úÖ Write multi-table INNER JOIN queries</li>
                    <li>‚úÖ Use table aliases for readability</li>
                    <li>‚úÖ Apply COUNT and AVG with GROUP BY</li>
                    <li>‚úÖ Filter aggregated results with HAVING</li>
                </ul>
            </div>
        </div>

        <!-- Slide 28: Exercise 1 -->
        <div class="slide">
            <h1>Exercise 1: Three-Table JOIN</h1>
            <h2>Individual Exercise (20 minutes)</h2>

            <div class="activity-box">
                <h3>Your Task:</h3>
                <p style="font-size: 1.1em;">Write an SQL query for YOUR project that requires a <strong>THREE-TABLE INNER JOIN</strong> and uses table aliases for readability.</p>
            </div>

            <div class="demo-box">
                <h3>Query Goal Examples:</h3>
                <ul style="font-size: 1.05em;">
                    <li><strong>Recipe DB:</strong> Find ingredients used in dessert recipes, showing ingredient names and quantities</li>
                    <li><strong>Movie Rental:</strong> Show rentals for a specific member, including movie titles and rental dates</li>
                    <li><strong>E-commerce:</strong> List order items with product names and supplier information</li>
                    <li><strong>Event Planner:</strong> Show events with venue details and organizer names</li>
                </ul>
            </div>

            <div class="tip-box">
                <h3>Requirements:</h3>
                <ul style="font-size: 1.05em;">
                    <li>Join at least THREE of your tables using INNER JOIN</li>
                    <li>Use table aliases (e.g., r, c, i) for readability</li>
                    <li>Select meaningful columns from all three tables</li>
                    <li>Include a WHERE filter to limit results</li>
                </ul>
            </div>

            <button data-timer="20">Start 20-Minute Timer</button>
        </div>

        <!-- Slide 29: Understanding Exercise 1 -->
        <div class="slide">
            <h1>Understanding: Three-Table JOINs</h1>

            <div class="tip-box">
                <h3>Example Solution (Recipe Database):</h3>
            </div>

            <div class="sql-example" style="font-size: 0.85em;">
                <span class="sql-comment">-- Find all ingredients in dessert recipes</span><br>
                <span class="sql-keyword">SELECT</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;r.recipe_id,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;r.recipe_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;i.ingredient_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;ri.quantity,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;ri.unit<br>
                <span class="sql-keyword">FROM</span> recipes r<br>
                <span class="sql-keyword">INNER JOIN</span> recipe_ingredients ri <span class="sql-keyword">ON</span> r.recipe_id = ri.recipe_id<br>
                <span class="sql-keyword">INNER JOIN</span> ingredients i <span class="sql-keyword">ON</span> ri.ingredient_id = i.ingredient_id<br>
                <span class="sql-keyword">WHERE</span> r.category_id = (<span class="sql-keyword">SELECT</span> category_id <span class="sql-keyword">FROM</span> categories <span class="sql-keyword">WHERE</span> category_name = <span class="sql-string">'Desserts'</span>);
            </div>

            <div class="demo-box">
                <h3>Key Insights:</h3>
                <ul style="font-size: 1.05em; line-height: 1.7;">
                    <li><strong>JOIN Order:</strong> Start with main table, join linking/junction table, then related table</li>
                    <li><strong>Table Aliases:</strong> r, ri, i make the query much more readable</li>
                    <li><strong>ON Conditions:</strong> Connect tables via foreign keys</li>
                    <li><strong>INNER JOIN:</strong> Only returns rows where matches exist in all three tables</li>
                </ul>
            </div>
        </div>

        <!-- Slide 30: Understanding Exercise 1 (continued) -->
        <div class="slide">
            <h1>Understanding: JOIN Execution Flow</h1>

            <div class="concept-box">
                <h3>How the Database Processes This Query:</h3>
                <ol style="font-size: 1.05em; line-height: 1.8;">
                    <li><strong>Step 1:</strong> Filter main table based on WHERE condition</li>
                    <li><strong>Step 2:</strong> JOIN with linking/junction table using foreign key</li>
                    <li><strong>Step 3:</strong> JOIN result with related table using second foreign key</li>
                    <li><strong>Step 4:</strong> Project (SELECT) the requested columns</li>
                </ol>
            </div>

            <div class="sql-example" style="font-size: 0.85em;">
                <h3>Sample Result Set (Recipe Example):</h3>
                <table class="table-result">
                    <tr>
                        <th>recipe_id</th>
                        <th>recipe_name</th>
                        <th>ingredient_name</th>
                        <th>quantity</th>
                        <th>unit</th>
                    </tr>
                    <tr>
                        <td>101</td>
                        <td>Chocolate Cake</td>
                        <td>Flour</td>
                        <td>2</td>
                        <td>cups</td>
                    </tr>
                    <tr>
                        <td>101</td>
                        <td>Chocolate Cake</td>
                        <td>Sugar</td>
                        <td>1.5</td>
                        <td>cups</td>
                    </tr>
                    <tr>
                        <td>101</td>
                        <td>Chocolate Cake</td>
                        <td>Cocoa Powder</td>
                        <td>0.75</td>
                        <td>cups</td>
                    </tr>
                </table>
            </div>

            <div class="tip-box">
                <strong>Pro Tip:</strong> Using aliases (r, ri, i) is considered best practice for multi-table queries!
            </div>
        </div>

        <!-- Slide 31: Exercise 2 -->
        <div class="slide">
            <h1>Exercise 2: Aggregation & Grouping</h1>
            <h2>Individual Exercise (20 minutes)</h2>

            <div class="activity-box">
                <h3>Your Task:</h3>
                <p style="font-size: 1.1em;">Write SQL queries for YOUR project using <strong>aggregate functions</strong> with GROUP BY and HAVING clauses to analyze your data.</p>
            </div>

            <div class="demo-box">
                <h3>Query Examples (adapt to YOUR schema):</h3>
                <ul style="font-size: 1.05em;">
                    <li><strong>Recipe DB:</strong> Count recipes per category, show only categories with >5 recipes</li>
                    <li><strong>Movie Rental:</strong> Average rental price per studio, include only studios with avg > $3</li>
                    <li><strong>E-commerce:</strong> Total sales per supplier, show only suppliers with sales > $1000</li>
                    <li><strong>Events:</strong> Event count per venue, include only venues hosting >3 events</li>
                </ul>
            </div>

            <div class="tip-box">
                <h3>Requirements:</h3>
                <ul style="font-size: 1.05em;">
                    <li>Write at least 2 queries with different aggregate functions</li>
                    <li>Use GROUP BY to organize results</li>
                    <li>Use HAVING to filter aggregated results</li>
                    <li>Include meaningful column aliases</li>
                </ul>
            </div>

            <button data-timer="20">Start 20-Minute Timer</button>
        </div>

        <!-- Slide 32: Understanding Exercise 2 -->
        <div class="slide">
            <h1>Understanding: Aggregation Solutions</h1>

            <div class="tip-box">
                <h3>Example Solutions:</h3>
            </div>

            <div class="sql-example" style="font-size: 0.9em;">
                <span class="sql-comment">-- Recipe DB: Categories with many recipes</span><br>
                <span class="sql-keyword">SELECT</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;category_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">COUNT</span>(*) <span class="sql-keyword">AS</span> recipe_count,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">AVG</span>(prep_time_minutes) <span class="sql-keyword">AS</span> avg_prep_time<br>
                <span class="sql-keyword">FROM</span> recipes r<br>
                <span class="sql-keyword">JOIN</span> categories c <span class="sql-keyword">ON</span> r.category_id = c.category_id<br>
                <span class="sql-keyword">GROUP BY</span> category_name<br>
                <span class="sql-keyword">HAVING</span> <span class="sql-function">COUNT</span>(*) > <span class="sql-number">5</span>;<br><br>

                <span class="sql-comment">-- E-commerce: High-value suppliers</span><br>
                <span class="sql-keyword">SELECT</span><br>
                &nbsp;&nbsp;&nbsp;&nbsp;s.supplier_name,<br>
                &nbsp;&nbsp;&nbsp;&nbsp;<span class="sql-function">SUM</span>(p.price * p.quantity) <span class="sql-keyword">AS</span> total_value<br>
                <span class="sql-keyword">FROM</span> suppliers s<br>
                <span class="sql-keyword">JOIN</span> products p <span class="sql-keyword">ON</span> s.supplier_id = p.supplier_id<br>
                <span class="sql-keyword">GROUP BY</span> s.supplier_name<br>
                <span class="sql-keyword">HAVING</span> <span class="sql-function">SUM</span>(p.price * p.quantity) > <span class="sql-number">1000</span>;
            </div>
        </div>

        <!-- Slide 27: Quick Review - GROUP BY vs HAVING -->
        <div class="slide">
            <h1>Quick Review: GROUP BY & HAVING</h1>
            <h2>From Lecture 7</h2>

            <div class="tip-box">
                <strong>Quick Review from Lecture 7:</strong>
                <ul style="font-size: 1.15em; line-height: 1.8;">
                    <li><strong>GROUP BY:</strong> Groups rows by column values</li>
                    <li><strong>HAVING:</strong> Filters groups (use after GROUP BY)</li>
                    <li><strong>WHERE vs HAVING:</strong> WHERE filters rows BEFORE grouping, HAVING filters AFTER</li>
                </ul>
                <p style="margin-top: 20px; font-size: 1.1em;"><strong>Now let's use these with JOINs!</strong></p>
            </div>

            <div class="demo-box">
                <h3>Example with JOINs + Aggregation:</h3>
                <div class="sql-example" style="font-size: 0.85em;">
                    <span class="sql-comment">-- Count items per category, show only categories with >5 items</span><br>
                    <span class="sql-keyword">SELECT</span> c.category_name, <span class="sql-function">COUNT</span>(i.item_id) <span class="sql-keyword">AS</span> item_count<br>
                    <span class="sql-keyword">FROM</span> categories c<br>
                    <span class="sql-keyword">LEFT JOIN</span> items i <span class="sql-keyword">ON</span> c.category_id = i.category_id<br>
                    <span class="sql-keyword">GROUP BY</span> c.category_name<br>
                    <span class="sql-keyword">HAVING</span> <span class="sql-function">COUNT</span>(i.item_id) > <span class="sql-number">5</span>;
                </div>
            </div>
        </div>

        <!-- Slide 34: Summary -->
        <div class="slide">
            <h1>Today's Takeaways <span class="emoji">üéì</span></h1>
            <h2>You Can Now:</h2>
            <ul style="font-size: 1.2em; line-height: 1.8;">
                <li>‚úÖ Use LEFT, RIGHT, and FULL OUTER JOINs effectively</li>
                <li>‚úÖ Write scalar, row, and correlated subqueries</li>
                <li>‚úÖ Apply EXISTS/NOT EXISTS for efficient filtering</li>
                <li>‚úÖ Use ANY, ALL, and SOME with subqueries</li>
                <li>‚úÖ Combine queries with set operations</li>
                <li>‚úÖ Build JOIN-based API endpoints for YOUR project</li>
                <li>‚úÖ Display related data beautifully in your frontend</li>
                <li>‚úÖ Return enriched data (names, not IDs) from APIs</li>
            </ul>
            <div class="demo-box">
                <p><strong>Next Lecture:</strong> Database Views and Stored Procedures</p>
            </div>
        </div>

        <!-- Navigation Controls -->
        <div class="navigation">
            <button id="prevBtn">Previous</button>
            <span class="slide-counter">
                <span id="currentSlide">1</span> / <span id="totalSlides">35</span>
            </span>
            <button id="nextBtn">Next</button>
        </div>
    </div>

    <!-- Shared Presentation JavaScript -->
    <script src="../../js/presentation.js"></script>

    <!-- Lecture-Specific JavaScript -->
    <script>
        // Note: SQL example animations now handled by presentation.js

        // Lecture-specific: SQL keyword reference shortcuts
        document.addEventListener('keydown', (e) => {
            if (e.ctrlKey && e.shiftKey) {
                switch(e.key) {
                    case 'S':
                        console.log('SQL Reference: SELECT, FROM, WHERE, GROUP BY, HAVING, ORDER BY');
                        break;
                    case 'J':
                        console.log('JOIN Types: INNER, LEFT, RIGHT, FULL OUTER, CROSS');
                        break;
                    case 'F':
                        console.log('Functions: COUNT, SUM, AVG, MIN, MAX');
                        break;
                }
            }
        });
    </script>
</body>
</html>